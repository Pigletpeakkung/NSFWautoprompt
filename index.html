<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Advanced Male Character Prompt Generator Pro</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <style>
    :root {
      --primary: #1e3a8a;
      --secondary: #1e40af;
      --accent: #dc2626;
      --success: #059669;
      --bg: #f0f9ff;
      --doujin-pink: #ff6b9d;
      --doujin-purple: #c084fc;
    }
    * {
      box-sizing: border-box;
    }
    html, body {
      margin: 0;
      padding: 0;
    }
    body {
      background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
      color: #1f2937;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      padding: 1rem;
      min-height: 100vh;
    }
    .container {
      max-width: 1400px;
      margin: 0 auto;
    }
    header h1 {
      font-size: 2.2rem;
      margin-bottom: 0.5rem;
      background: linear-gradient(135deg, var(--primary), var(--doujin-purple));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .card {
      border: none;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      transition: all 0.3s ease;
      margin-bottom: 1rem;
      background: #fff;
    }
    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 16px rgba(0,0,0,0.12);
    }
    .card-header {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: #fff;
      border-radius: 12px 12px 0 0;
      padding: 0.9rem 1.2rem;
      cursor: pointer;
      user-select: none;
      transition: all 0.3s;
      font-weight: 600;
    }
    .card-header h5 {
      margin: 0;
      font-size: 1.05rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .card-header:hover {
      background: linear-gradient(135deg, var(--secondary), var(--primary));
    }
    .card-body {
      padding: 1.2rem;
    }
    .btn-primary {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      border: none;
      transition: all 0.3s;
      font-weight: 600;
      padding: 0.75rem 1.5rem;
      box-shadow: 0 4px 12px rgba(30, 58, 138, 0.3);
      border-radius: 8px;
    }
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(30, 58, 138, 0.4);
    }
    .btn-success {
      background-color: var(--success);
      border: none;
      padding: 0.75rem 1.5rem;
      font-weight: 600;
      border-radius: 8px;
    }
    .btn-accent {
      background-color: var(--accent);
      color: #fff;
      border: none;
      padding: 0.75rem 1.5rem;
      font-weight: 600;
      border-radius: 8px;
    }
    .btn-doujin {
      background: linear-gradient(135deg, var(--doujin-pink), var(--doujin-purple));
      color: #fff;
      border: none;
      padding: 0.75rem 1.5rem;
      font-weight: 600;
      border-radius: 8px;
    }
    .form-select, .form-control, textarea {
      border-radius: 8px;
      border: 2px solid #e2e8f0;
      transition: all 0.2s;
      font-size: 0.95rem;
      padding: 0.6rem 0.9rem;
    }
    .form-select:focus, .form-control:focus, textarea:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 4px rgba(30, 58, 138, 0.1);
      outline: none;
    }
    #output {
      display: none;
      font-family: 'Courier New', monospace;
      white-space: pre-wrap;
      word-wrap: break-word;
      background: #fff;
      border-left: 5px solid var(--primary);
      font-size: 0.9rem;
      line-height: 1.8;
      overflow-y: auto;
      max-height: 600px;
      color: #1f2937;
      animation: slideIn 0.4s ease-out;
      padding: 1.5rem;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    .quality-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      padding: 0.75rem 0;
    }
    .quality-badge {
      background: #dbeafe;
      color: #0369a1;
      padding: 0.5rem 1rem;
      border-radius: 25px;
      font-size: 0.85rem;
      cursor: pointer;
      transition: all 0.25s;
      border: 2px solid #93c5fd;
      white-space: nowrap;
      user-select: none;
      font-weight: 500;
    }
    .quality-badge:hover {
      transform: scale(1.1);
      background: #bfdbfe;
    }
    .quality-badge.active {
      background: var(--primary);
      color: #fff;
      border-color: var(--primary);
      box-shadow: 0 0 12px rgba(30, 58, 138, 0.4);
      transform: scale(1.05);
    }
    .section-title {
      font-weight: 700;
      color: var(--primary);
      margin: 1.5rem 0 1rem 0;
      padding-bottom: 0.6rem;
      border-bottom: 3px solid var(--primary);
      display: flex;
      align-items: center;
      gap: 0.8rem;
      font-size: 1.2rem;
    }
    .stats {
      font-size: 0.9rem;
      color: #6b7280;
      padding: 1.2rem;
      background: rgba(226, 232, 240, 0.6);
      border-radius: 10px;
      text-align: center;
      margin-top: 1rem;
      border: 2px solid #e2e8f0;
    }
    .tab-content {
      background: rgba(255,255,255,0.98);
      padding: 1.5rem;
      border-radius: 0 0 12px 12px;
      min-height: 450px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }
    .nav-tabs {
      border-bottom: 3px solid var(--primary);
      background: rgba(255,255,255,0.95);
      border-radius: 12px 12px 0 0;
      padding: 0.5rem 0.5rem 0 0.5rem;
    }
    .nav-link {
      color: #6b7280;
      border: none;
      font-weight: 600;
      transition: all 0.2s;
      font-size: 0.95rem;
      padding: 0.8rem 1.2rem;
      border-radius: 8px 8px 0 0;
      margin-right: 0.3rem;
    }
    .nav-link:hover {
      color: var(--primary);
      background: rgba(30, 58, 138, 0.05);
    }
    .nav-link.active {
      color: #fff !important;
      background: var(--primary) !important;
    }
    label {
      font-weight: 600;
      color: #1f2937;
      margin-bottom: 0.5rem;
      font-size: 0.95rem;
      display: block;
    }
    .row {
      margin-bottom: 0.75rem;
    }
    .btn-group-custom {
      display: flex;
      flex-wrap: wrap;
      gap: 0.6rem;
      margin: 1.2rem 0;
    }
    small.text-muted {
      font-size: 0.8rem;
      color: #6b7280;
    }
    .badge {
      font-size: 0.75rem;
      padding: 0.4rem 0.8rem;
    }
    .collapse {
      transition: height 0.3s ease;
    }
    
    /* PREVIEW CARD */
    .preview-card {
      background: linear-gradient(135deg, #f0f9ff 0%, #e0e7ff 100%);
      border-radius: 12px;
      padding: 2rem;
      margin-bottom: 1.5rem;
      box-shadow: 0 6px 16px rgba(0,0,0,0.12);
      border: 3px solid #bfdbfe;
    }
    .preview-avatar {
      background: linear-gradient(135deg, var(--primary), var(--doujin-purple));
      border-radius: 50%;
      width: 140px;
      height: 140px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 1.5rem;
      box-shadow: 0 6px 20px rgba(30, 58, 138, 0.4);
      animation: pulse 2.5s ease-in-out infinite;
    }
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.08); }
    }
    .preview-avatar i {
      color: #fff;
      font-size: 4.5rem;
    }
    .preview-details {
      background: #fff;
      padding: 1.5rem;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    .preview-details p {
      margin-bottom: 0.7rem;
      font-size: 0.95rem;
    }
    .preview-details strong {
      color: var(--primary);
      min-width: 120px;
      display: inline-block;
    }
    
    /* PRESET CARDS */
    .preset-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 1.2rem;
      margin: 1.2rem 0;
    }
    .preset-card {
      background: linear-gradient(135deg, #fff 0%, #f8fafc 100%);
      border: 3px solid #e2e8f0;
      border-radius: 12px;
      padding: 2rem;
      cursor: pointer;
      transition: all 0.3s;
      text-align: center;
    }
    .preset-card:hover {
      transform: translateY(-6px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.18);
      border-color: var(--primary);
    }
    .preset-card i {
      font-size: 3.5rem;
      margin-bottom: 1.2rem;
      background: linear-gradient(135deg, var(--primary), var(--doujin-purple));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .preset-card h5 {
      font-weight: 700;
      margin-bottom: 0.6rem;
      color: var(--primary);
      font-size: 1.1rem;
    }
    .preset-card p {
      font-size: 0.9rem;
      color: #6b7280;
      margin: 0;
    }
    
    /* DOUJINSHI STYLE INDICATOR */
    .doujin-badge {
      display: inline-block;
      background: linear-gradient(135deg, var(--doujin-pink), var(--doujin-purple));
      color: #fff;
      padding: 0.35rem 0.9rem;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 700;
      margin-left: 0.5rem;
      box-shadow: 0 2px 8px rgba(255, 107, 157, 0.4);
    }
    
    /* LOADING ANIMATION */
    .loading {
      display: none;
      text-align: center;
      padding: 2.5rem;
    }
    .loading.active {
      display: block;
    }
    .spinner {
      border: 5px solid #f3f4f6;
      border-top: 5px solid var(--primary);
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin: 0 auto 1rem;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* ENHANCED OUTPUT STYLES */
    .output-container {
      margin-top: 2rem;
      animation: fadeIn 0.5s ease-in;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .copy-notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: var(--success);
      color: white;
      padding: 1rem 1.5rem;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      z-index: 9999;
      animation: slideInRight 0.3s ease-out;
      display: none;
    }
    .copy-notification.show {
      display: block;
    }
    @keyframes slideInRight {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    /* RESPONSIVE */
    @media (max-width: 768px) {
      header h1 {
        font-size: 1.6rem;
      }
      .preset-grid {
        grid-template-columns: 1fr;
      }
      .nav-link {
        font-size: 0.85rem;
        padding: 0.6rem 0.8rem;
      }
      .preview-avatar {
        width: 100px;
        height: 100px;
      }
      .preview-avatar i {
        font-size: 3rem;
      }
    }

    /* COLLAPSIBLE ANIMATIONS */
    .collapsing {
      transition: height 0.35s ease;
    }

    /* SELECT OPTION GROUPS */
    optgroup {
      font-weight: 700;
      color: var(--primary);
      font-size: 0.95rem;
    }
    option {
      padding: 0.5rem;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- COPY NOTIFICATION -->
    <div class="copy-notification" id="copyNotification">
      <i class="fas fa-check-circle"></i> Prompt copied to clipboard!
    </div>

    <header class="text-center mb-4">
      <h1><i class="fas fa-male"></i> Advanced Male Character Prompt Generator Pro</h1>
      <p class="text-muted">Professional AI-ready prompts for character art, yaoi & doujinshi illustration</p>
      <div class="mt-2">
        <span class="badge bg-primary">1000+ Combinations</span>
        <span class="badge bg-success">Lighting System</span>
        <span class="badge" style="background: linear-gradient(135deg, #ff6b9d, #c084fc); color: white;">Yaoi Optimized</span>
      </div>
    </header>

    <!-- QUICK PRESET CARDS -->
    <div class="card mb-3">
      <div class="card-header bg-success text-white">
        <h5><i class="fas fa-bolt"></i> Quick Presets - Click to Load</h5>
      </div>
      <div class="card-body">
        <div class="preset-grid">
          <div class="preset-card" onclick="loadPreset('doujin_bishonen')">
            <i class="fas fa-heart"></i>
            <h5>Doujinshi Bishonen <span class="doujin-badge">Hot</span></h5>
            <p>Elegant flower boy with soft androgynous features</p>
          </div>
          <div class="preset-card" onclick="loadPreset('doujin_muscular')">
            <i class="fas fa-dumbbell"></i>
            <h5>Athletic Wet Body</h5>
            <p>Muscular physique with glistening defined abs</p>
          </div>
          <div class="preset-card" onclick="loadPreset('supernatural_fox')">
            <i class="fas fa-paw"></i>
            <h5>Kitsune Fox Spirit</h5>
            <p>Fox ears, multiple tails, mystical aura</p>
          </div>
          <div class="preset-card" onclick="loadPreset('wet_shower')">
            <i class="fas fa-droplet"></i>
            <h5>Shower Scene <span class="doujin-badge">NSFW</span></h5>
            <p>Soaking wet, towel wrapped, steam effects</p>
          </div>
          <div class="preset-card" onclick="loadPreset('cyberpunk_neon')">
            <i class="fas fa-microchip"></i>
            <h5>Cyberpunk Neon</h5>
            <p>Tech implants, neon underglow, futuristic</p>
          </div>
          <div class="preset-card" onclick="loadPreset('vampire_elegant')">
            <i class="fas fa-moon"></i>
            <h5>Vampire Lord</h5>
            <p>Dark elegant immortal beauty, crimson eyes</p>
          </div>
        </div>
      </div>
    </div>

    <!-- LIVE PREVIEW CARD -->
    <div class="preview-card" id="previewCard" style="display:none;">
      <h5 class="text-center mb-3"><i class="fas fa-eye"></i> Live Character Preview</h5>
      <div class="row">
        <div class="col-md-3 text-center">
          <div class="preview-avatar">
            <i class="fas fa-user"></i>
          </div>
                    <p><strong id="previewName">Your Character</strong></p>
        </div>
        <div class="col-md-9">
          <div class="preview-details">
            <p><strong>Type:</strong> <span id="prevArch">Not set</span></p>
            <p><strong>Hair:</strong> <span id="prevHair">Not set</span></p>
            <p><strong>Eyes:</strong> <span id="prevEyes">Not set</span></p>
            <p><strong>Skin:</strong> <span id="prevSkin">Not set</span></p>
            <p><strong>Body:</strong> <span id="prevBody">Not set</span></p>
            <p><strong>Pose:</strong> <span id="prevPose">Not set</span></p>
            <p><strong>Lighting:</strong> <span id="prevLight">Not set</span></p>
            <p><strong>Special:</strong> <span id="prevSpecial">None</span></p>
          </div>
        </div>
      </div>
    </div>

    <!-- Navigation Tabs -->
    <ul class="nav nav-tabs mb-0" role="tablist">
      <li class="nav-item">
        <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#charTab" type="button">
          <i class="fas fa-user"></i> Character
        </button>
      </li>
      <li class="nav-item">
        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#appearanceTab" type="button">
          <i class="fas fa-face-smile"></i> Appearance
        </button>
      </li>
      <li class="nav-item">
        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#bodyTab" type="button">
          <i class="fas fa-dumbbell"></i> Body
        </button>
      </li>
      <li class="nav-item">
        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#poseTab" type="button">
          <i class="fas fa-person-hiking"></i> Pose
        </button>
      </li>
      <li class="nav-item">
        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#envTab" type="button">
          <i class="fas fa-globe"></i> Environment
        </button>
      </li>
      <li class="nav-item">
        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#effectsTab" type="button">
          <i class="fas fa-wand-sparkles"></i> Effects
        </button>
      </li>
      <li class="nav-item">
        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#qualityTab" type="button">
          <i class="fas fa-star"></i> Quality
        </button>
      </li>
    </ul>

    <div class="tab-content">
      <!-- CHARACTER TAB -->
      <div class="tab-pane fade show active" id="charTab" role="tabpanel">
        <div class="section-title"><i class="fas fa-user-tie"></i> Character Archetype</div>
        <div class="card">
          <div class="card-header" data-bs-toggle="collapse" data-bs-target="#archeCard">
            <h5>Character Type (15 Options)</h5>
          </div>
          <div class="collapse show" id="archeCard">
            <div class="card-body">
              <select id="characterArchetype" class="form-select" onchange="updatePreview()">
                <option value="">-- None --</option>
                <option value="1boy solo male focus noble warrior prince regal bearing">Noble warrior prince with regal bearing</option>
                <option value="1boy solo male focus cyberpunk hacker tech implants">Cyberpunk hacker with tech implants</option>
                <option value="1boy solo male focus mystical sorcerer dark magic">Mystical sorcerer channeling dark magic</option>
                <option value="1boy solo male focus space commander intergalactic">Space commander leading fleet</option>
                <option value="1boy solo male focus demon slayer battle hardened">Demon slayer battle hardened</option>
                <option value="1boy solo male focus underworld assassin mysterious">Underworld assassin shrouded in mystery</option>
                <option value="1boy solo male focus ancient vampire immortal elegant">Ancient vampire immortal elegant</option>
                <option value="1boy solo male focus rebel knight against tyranny">Rebel knight against tyranny</option>
                <option value="1boy solo male focus mad scientist dark experiments">Mad scientist conducting experiments</option>
                <option value="1boy solo male focus time traveler dimensional">Time traveler from distant era</option>
                <option value="1boy solo male focus supernatural hunter tracking creatures">Supernatural hunter tracking creatures</option>
                <option value="1boy solo male focus dark lord commanding legions">Dark lord commanding legions</option>
                <option value="1boy solo male focus fallen angel redemption">Fallen angel seeking redemption</option>
                <option value="1boy solo male focus pirate captain high seas">Pirate captain ruling high seas</option>
                <option value="1boy solo male focus ronin wandering samurai">Ronin wandering samurai masterless</option>
              </select>
            </div>
          </div>
        </div>

        <div class="section-title"><i class="fas fa-calendar"></i> Age & Build</div>
        <div class="card">
          <div class="card-header" data-bs-toggle="collapse" data-bs-target="#ageCard">
            <h5>Age Group & Body Frame</h5>
          </div>
          <div class="collapse show" id="ageCard">
            <div class="card-body">
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="ageGroup">Age Group</label>
                  <select id="ageGroup" class="form-select" onchange="updatePreview()">
                    <option value="">-- None --</option>
                    <option value="late teens 18-19">Late teens (18-19)</option>
                    <option value="young adult 20-25">Young adult (20-25)</option>
                    <option value="adult male 25-30">Adult male (25-30)</option>
                    <option value="mature adult 30-40">Mature adult (30-40)</option>
                    <option value="seasoned 40-50">Seasoned (40-50)</option>
                    <option value="distinguished elder 50+">Distinguished elder (50+)</option>
                    <option value="ageless timeless immortal">Ageless timeless immortal</option>
                  </select>
                </div>
                <div class="col-md-6 mb-3">
                  <label for="bodyFrame">Body Frame</label>
                  <select id="bodyFrame" class="form-select" onchange="updatePreview()">
                    <option value="">-- None --</option>
                    <option value="lean athletic toned">Lean athletic toned</option>
                    <option value="muscular powerful built">Muscular powerful built</option>
                    <option value="bulky massive bodybuilder">Bulky massive bodybuilder</option>
                    <option value="tall slender graceful">Tall slender graceful</option>
                    <option value="stocky robust solid">Stocky robust solid</option>
                    <option value="lithe agile nimble">Lithe agile nimble</option>
                    <option value="otherworldly ethereal androgynous">Otherworldly ethereal androgynous</option>
                    <option value="imposing towering giant">Imposing towering giant</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- APPEARANCE TAB -->
      <div class="tab-pane fade" id="appearanceTab" role="tabpanel">
        <div class="section-title"><i class="fas fa-face-smile"></i> Face & Features</div>
        <div class="card">
          <div class="card-header" data-bs-toggle="collapse" data-bs-target="#faceCard">
            <h5>Facial Structure</h5>
          </div>
          <div class="collapse show" id="faceCard">
            <div class="card-body">
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="faceType">Face Shape</label>
                  <select id="faceType" class="form-select" onchange="updatePreview()">
                    <option value="">-- None --</option>
                    <option value="chiseled angular jawline sharp">Chiseled angular jawline sharp</option>
                    <option value="strong square jaw masculine">Strong square jaw masculine</option>
                    <option value="sharp defined features striking">Sharp defined features striking</option>
                    <option value="soft masculine gentle face">Soft masculine gentle face</option>
                    <option value="rugged weathered battle scarred">Rugged weathered battle scarred</option>
                    <option value="ethereal beautiful androgynous">Ethereal beautiful androgynous</option>
                    <option value="intimidating severe harsh">Intimidating severe harsh</option>
                    <option value="refined elegant noble">Refined elegant noble</option>
                  </select>
                </div>
                <div class="col-md-6 mb-3">
                  <label for="facialHair">Facial Hair</label>
                  <select id="facialHair" class="form-select" onchange="updatePreview()">
                    <option value="">-- None --</option>
                    <option value="clean shaved smooth">Clean shaved smooth</option>
                    <option value="light stubble 5 o'clock shadow">Light stubble 5 o'clock shadow</option>
                    <option value="full beard thick">Full beard thick</option>
                    <option value="rugged unkempt beard">Rugged unkempt beard</option>
                    <option value="perfectly groomed beard">Perfectly groomed beard</option>
                    <option value="goatee stylized">Goatee stylized</option>
                    <option value="mustache handlebar">Mustache handlebar</option>
                    <option value="sideburns mutton chops">Sideburns mutton chops</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="section-title"><i class="fas fa-scissors"></i> Hair Details</div>
        <div class="card">
          <div class="card-header" data-bs-toggle="collapse" data-bs-target="#hairCard">
            <h5>Hair Style & Color (40+ Options)</h5>
          </div>
          <div class="collapse show" id="hairCard">
            <div class="card-body">
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="hairStyle">Hair Style</label>
                  <select id="hairStyle" class="form-select" onchange="updatePreview()">
                    <option value="">-- None --</option>
                    <option value="long flowing hair windswept">Long flowing hair windswept</option>
                    <option value="short cropped neat military">Short cropped neat military</option>
                    <option value="short hair stylish modern">Short hair stylish modern</option>
                    <option value="spiky messy styled">Spiky messy styled</option>
                    <option value="slicked back smooth gel">Slicked back smooth gel</option>
                    <option value="tousled bedhead natural">Tousled bedhead natural</option>
                    <option value="undercut shaved sides long top">Undercut shaved sides long top</option>
                    <option value="long ponytail tied back">Long ponytail tied back</option>
                    <option value="bald clean shaved head">Bald clean shaved head</option>
                    <option value="mohawk punk style">Mohawk punk style</option>
                    <option value="dreadlocks long">Dreadlocks long</option>
                    <option value="braided intricate">Braided intricate</option>
                    <option value="wavy medium length">Wavy medium length</option>
                    <option value="side parted professional">Side parted professional</option>
                    <option value="man bun top knot">Man bun top knot</option>
                    <option value="curly wild natural">Curly wild natural</option>
                    <option value="asymmetrical artistic">Asymmetrical artistic</option>
                    <option value="wet slicked dripping">Wet slicked dripping</option>
                    <option value="windblown dynamic">Windblown dynamic</option>
                    <option value="fade haircut modern">Fade haircut modern</option>
                  </select>
                </div>
                <div class="col-md-6 mb-3">
                  <label for="hairColor">Hair Color</label>
                  <select id="hairColor" class="form-select" onchange="updatePreview()">
                    <option value="">-- None --</option>
                    <option value="black hair raven">Black hair raven</option>
                    <option value="jet black dark">Jet black dark</option>
                    <option value="deep brown chocolate">Deep brown chocolate</option>
                    <option value="auburn red mahogany">Auburn red mahogany</option>
                    <option value="golden blonde sun-kissed">Golden blonde sun-kissed</option>
                    <option value="platinum blonde white">Platinum blonde white</option>
                    <option value="silver white metallic">Silver white metallic</option>
                    <option value="ashen gray steel">Ashen gray steel</option>
                    <option value="vibrant purple amethyst">Vibrant purple amethyst</option>
                    <option value="electric blue neon">Electric blue neon</option>
                    <option value="bright blue highlights">Bright blue highlights in hair</option>
                    <option value="fiery red crimson">Fiery red crimson</option>
                    <option value="mint green pastel">Mint green pastel</option>
                    <option value="rose gold pink">Rose gold pink</option>
                    <option value="iridescent multicolored rainbow">Iridescent multicolored rainbow</option>
                    <option value="two-tone split dyed">Two-tone split dyed</option>
                    <option value="highlights streaks ombre">Highlights streaks ombre</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="section-title"><i class="fas fa-eye"></i> Eyes & Expression</div>
        <div class="card">
          <div class="card-header" data-bs-toggle="collapse" data-bs-target="#eyeCard">
            <h5>Eye Color & Details</h5>
          </div>
          <div class="collapse show" id="eyeCard">
            <div class="card-body">
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="eyeColor">Eye Color</label>
                  <select id="eyeColor" class="form-select" onchange="updatePreview()">
                    <option value="">-- None --</option>
                    <option value="piercing blue ice cold">Piercing blue ice cold</option>
                    <option value="dark brown deep chocolate">Dark brown deep chocolate</option>
                    <option value="amber gold glowing">Amber gold glowing</option>
                    <option value="silver gray metallic">Silver gray metallic</option>
                    <option value="emerald green vibrant">Emerald green vibrant</option>
                    <option value="glowing purple mystical">Glowing purple mystical</option>
                    <option value="blood red crimson">Blood red crimson</option>
                    <option value="all black void pitch">All black void pitch</option>
                    <option value="heterochromia different colors">Heterochromia (different colors)</option>
                    <option value="glowing bright luminous">Glowing bright luminous</option>
                    <option value="turquoise cyan bright">Turquoise cyan bright</option>
                    <option value="violet amethyst deep">Violet amethyst deep</option>
                  </select>
                </div>
                <div class="col-md-6 mb-3">
                  <label for="eyeDetail">Eye Details</label>
                  <select id="eyeDetail" class="form-select" onchange="updatePreview()">
                    <option value="">-- None --</option>
                    <option value="big expressive eyes detailed">Big expressive eyes detailed</option>
                    <option value="sharp intense gaze piercing">Sharp intense gaze piercing</option>
                    <option value="narrow seductive bedroom eyes">Narrow seductive bedroom eyes</option>
                    <option value="wide innocent surprised">Wide innocent surprised</option>
                    <option value="tired heavy lidded">Tired heavy lidded</option>
                    <option value="fierce determined battle">Fierce determined battle ready</option>
                    <option value="gentle soft kind">Gentle soft kind</option>
                    <option value="glowing supernatural mystical">Glowing supernatural mystical</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="section-title"><i class="fas fa-palette"></i> Skin Details</div>
        <div class="card">
          <div class="card-header" data-bs-toggle="collapse" data-bs-target="#skinCard">
            <h5>Skin Tone & Texture (30+ Options)</h5>
          </div>
          <div class="collapse show" id="skinCard">
            <div class="card-body">
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="skinTone">Skin Tone</label>
                  <select id="skinTone" class="form-select" onchange="updatePreview()">
                    <option value="">-- None --</option>
                    <option value="fair pale porcelain">Fair pale porcelain</option>
                    <option value="ivory cream light">Ivory cream light</option>
                    <option value="beige natural warm">Beige natural warm</option>
                    <option value="olive tan mediterranean">Olive tan mediterranean</option>
                    <option value="golden bronze sun-kissed">Golden bronze sun-kissed</option>
                    <option value="caramel brown rich">Caramel brown rich</option>
                    <option value="deep dark ebony">Deep dark ebony</option>
                    <option value="mahogany deep brown">Mahogany deep brown</option>
                    <option value="ashen gray supernatural">Ashen gray supernatural</option>
                    <option value="luminous ethereal glowing">Luminous ethereal glowing</option>
                    <option value="blue tinted mystical">Blue tinted mystical</option>
                    <option value="green tinted forest spirit">Green tinted forest spirit</option>
                  </select>
                </div>
                <div class="col-md-6 mb-3">
                  <label for="skinTexture">Skin Texture & Surface</label>
                  <select id="skinTexture" class="form-select" onchange="updatePreview()">
                    <option value="">-- None --</option>
                    <option value="smooth flawless perfect skin">Smooth flawless perfect skin</option>
                    <option value="smooth quality detailed skin">Smooth quality detailed skin</option>
                    <option value="porcelain smooth polished">Porcelain smooth polished</option>
                    <option value="soft supple tender">Soft supple tender</option>
                    <option value="weathered rugged rough">Weathered rugged rough</option>
                    <option value="battle scarred marked">Battle scarred marked</option>
                    <option value="wet glistening shiny">Wet glistening shiny</option>
                    <option value="wet skin dripping water droplets">Wet skin dripping water droplets</option>
                    <option value="soaking wet drenched">Soaking wet completely drenched</option>
                    <option value="sweaty glistening moist">Sweaty glistening moist</option>
                    <option value="oiled shiny gleaming">Oiled shiny gleaming</option>
                    <option value="slime covered slimy">Slime covered slimy</option>
                    <option value="glowing ethereal luminous">Glowing ethereal luminous</option>
                    <option value="metallic shine reflective">Metallic shine reflective</option>
                    <option value="tattooed covered ink">Tattooed covered ink</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="section-title"><i class="fas fa-dragon"></i> Special Features</div>
        <div class="card">
          <div class="card-header" data-bs-toggle="collapse" data-bs-target="#specialCard">
            <h5>Fantasy & Supernatural Features</h5>
          </div>
          <div class="collapse show" id="specialCard">
            <div class="card-body">
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="wings">Wings</label>
                  <select id="wings" class="form-select" onchange="updatePreview()">
                    <option value="">-- None --</option>
                    <option value="angel wings white feathered">Angel wings white feathered</option>
                    <option value="demon wings black leathery">Demon wings black leathery</option>
                    <option value="dragon wings scaled">Dragon wings scaled</option>
                    <option value="fairy wings translucent">Fairy wings translucent</option>
                    <option value="bat wings dark membrane">Bat wings dark membrane</option>
                    <option value="mechanical wings cybernetic">Mechanical wings cybernetic</option>
                    <option value="energy wings glowing">Energy wings glowing</option>
                    <option value="phoenix wings fire">Phoenix wings fire</option>
                  </select>
                </div>
                <div class="col-md-6 mb-3">
                  <label for="supernatural">Supernatural Elements</label>
                  <select id="supernatural" class="form-select" multiple size="6" onchange="updatePreview()">
                    <option value="">-- None --</option>
                    <option value="fox ears kemonomimi">Fox ears kemonomimi</option>
                    <option value="cat ears neko">Cat ears neko</option>
                    <option value="wolf ears canine">Wolf ears canine</option>
                    <option value="horns demonic curved">Horns demonic curved</option>
                    <option value="tail animal fluffy">Tail animal fluffy</option>
                    <option value="many fox tails kitsune nine">Many fox tails kitsune</option>
                    <option value="pointed elf ears">Pointed elf ears</option>
                    <option value="fangs vampire sharp">Fangs vampire sharp</option>
                    <option value="glowing markings runes">Glowing markings runes</option>
                    <option value="halo divine golden">Halo divine golden</option>
                    <option value="aura energy surrounding">Aura energy surrounding</option>
                    <option value="floating debris magic">Floating debris magic</option>
                  </select>
                  <small class="text-muted">Hold Ctrl/Cmd for multiple</small>
                </div>
              </div>

              <div class="row">
                <div class="col-md-12 mb-3">
                  <label for="bodyMarks">Body Marks & Features</label>
                  <select id="bodyMarks" class="form-select" multiple size="5" onchange="updatePreview()">
                    <option value="">-- None --</option>
                    <option value="full body tattoos intricate">Full body tattoos intricate</option>
                    <option value="chest tattoo tribal">Chest tattoo tribal</option>
                    <option value="sleeve tattoos detailed">Sleeve tattoos detailed</option>
                    <option value="body scars battle worn">Body scars battle worn</option>
                    <option value="facial scar dramatic">Facial scar dramatic</option>
                    <option value="moles birthmarks beauty marks">Moles birthmarks beauty marks</option>
                    <option value="piercings ear nose lip">Piercings (ear, nose, lip)</option>
                    <option value="glowing marks mystical runes">Glowing marks mystical runes</option>
                    <option value="cybernetic implants tech">Cybernetic implants tech</option>
                    <option value="long nails sharp claws">Long nails sharp claws</option>
                  </select>
                  <small class="text-muted">Hold Ctrl/Cmd for multiple</small>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- BODY TAB -->
      <div class="tab-pane fade" id="bodyTab" role="tabpanel">
        <div class="section-title"><i class="fas fa-dumbbell"></i> Torso & Physique</div>
        <div class="card">
          <div class="card-header" data-bs-toggle="collapse" data-bs-target="#torsoCard">
            <h5>Body Definition & Torso State</h5>
          </div>
          <div class="collapse show" id="torsoCard">
            <div class="card-body">
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="torsoState">Torso Coverage</label>
                  <select id="torsoState" class="form-select" onchange="updatePreview()">
                    <option value="">-- None --</option>
                    <option value="fully clothed upper body">Fully clothed upper body</option>
                    <option value="shirtless bare chest exposed">Shirtless bare chest exposed</option>
                    <option value="partially clothed shirt open">Partially clothed shirt open</option>
                    <option value="shirt unbuttoned revealing torso">Shirt unbuttoned revealing torso</option>
                    <option value="shirt pulled up showing abs">Shirt pulled up showing abs</option>
                    <option value="sleeveless vest bare arms">Sleeveless vest bare arms</option>
                    <option value="jacket open no shirt underneath">Jacket open no shirt</option>
                    <option value="towel wrapped around waist shirtless">Towel wrapped around waist</option>
                  </select>
                </div>
                <div class="col-md-6 mb-3">
                  <label for="muscleDef">Muscle Definition</label>
                  <select id="muscleDef" class="form-select" onchange="updatePreview()">
                    <option value="">-- None --</option>
                    <option value="soft natural body">Soft natural body</option>
                    <option value="lean fit athletic">Lean fit athletic</option>
                    <option value="toned defined muscles">Toned defined muscles</option>
                    <option value="well defined six pack abs">Well-defined six pack abs</option>
                    <option value="prominent abs eight pack">Prominent abs eight pack</option>
                    <option value="massive bulging muscles">Massive bulging muscles</option>
                    <option value="ripped shredded physique">Ripped shredded physique</option>
                    <option value="bodybuilder hypermuscular">Bodybuilder hypermuscular</option>
                  </select>
                </div>
              </div>

              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="chest">Chest & Pectorals</label>
                  <select id="chest" class="form-select" onchange="updatePreview()">
                    <option value="">-- None --</option>
                    <option value="flat chest natural">Flat chest natural</option>
                    <option value="normal proportional chest">Normal proportional chest</option>
                    <option value="well developed pecs">Well developed pecs</option>
                    <option value="massive bulging pectorals">Massive bulging pectorals</option>
                    <option value="chiseled detailed chest">Chiseled detailed chest</option>
                    <option value="defined pecs visible">Defined pecs clearly visible</option>
                  </select>
                </div>
                <div class="col-md-6 mb-3">
                  <label for="shouldersArms">Shoulders & Arms</label>
                  <select id="shouldersArms" class="form-select" onchange="updatePreview()">
                    <option value="">-- None --</option>
                    <option value="average shoulders normal arms">Average shoulders normal arms</option>
                    <option value="broad shoulders wide">Broad shoulders wide</option>
                    <option value="extremely wide shoulders massive">Extremely wide shoulders massive</option>
                    <option value="toned biceps defined">Toned biceps defined</option>
                    <option value="bulging massive arms veiny">Bulging massive arms veiny</option>
                    <option value="muscular arms powerful">Muscular arms powerful</option>
                    <option value="slender elegant arms">Slender elegant arms</option>
                  </select>
                </div>
              </div>

              <div class="row">
                <div class="col-md-12 mb-3">
                  <label for="absDetail">Abdominal Detail</label>
                  <select id="absDetail" class="form-select" onchange="updatePreview()">
                    <option value="">-- None --</option>
                    <option value="no visible abs">No visible abs</option>
                    <option value="slight abs outline">Slight abs outline</option>
                    <option value="visible defined abs">Visible defined abs</option>
                    <option value="prominent six pack abs">Prominent six pack abs</option>
                    <option value="show abs extremely shredded">Show abs extremely shredded</option>
                    <option value="eight pack hyperdefined">Eight pack hyperdefined</option>
                    <option value="abs with v-line hip definition">Abs with v-line hip definition</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="section-title"><i class="fas fa-shirt"></i> Clothing & Attire</div>
        <div class="card">
          <div class="card-header" data-bs-toggle="collapse" data-bs-target="#clothCard">
            <h5>Outfit & Accessories</h5>
          </div>
          <div class="collapse show" id="clothCard">
            <div class="card-body">
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="outfit">Main Outfit</label>
                  <select id="outfit" class="form-select" onchange="updatePreview()">
                    <option value="">-- None / Minimal --</option>
                    <option value="medieval armor knight plate">Medieval armor knight plate</option>
                    <option value="flowing robes mystical wizard">Flowing robes mystical wizard</option>
                    <option value="futuristic bodysuit tight">Futuristic bodysuit tight</option>
                    <option value="tactical military gear combat">Tactical military gear combat</option>
                    <option value="noble elegant suit tailored">Noble elegant suit tailored</option>
                    <option value="casual modern streetwear">Casual modern streetwear</option>
                    <option value="gothic dark elegant victorian">Gothic dark elegant victorian</option>
                    <option value="dark muted blue male hanfu traditional">Dark muted blue male hanfu</option>
                    <option value="hanfu traditional chinese silk">Hanfu traditional Chinese silk</option>
                    <option value="kimono traditional japanese">Kimono traditional Japanese</option>
                    <option value="leather jacket edgy biker">Leather jacket edgy biker</option>
                    <option value="school uniform student blazer">School uniform student blazer</option>
                    <option value="business suit professional tie">Business suit professional tie</option>
                    <option value="pirate outfit swashbuckler">Pirate outfit swashbuckler</option>
                    <option value="cyberpunk neon streetwear techwear">Cyberpunk neon streetwear</option>
                    <option value="traditional tribal warrior">Traditional tribal warrior attire</option>
                  </select>
                </div>
                <div class="col-md-6 mb-3">
                  <label for="accessories">Accessories</label>
                  <select id="accessories" class="form-select" multiple size="6" onchange="updatePreview()">
                    <option value="">-- None --</option>
                    <option value="holding a fan elegant folding">Holding a fan elegant</option>
                    <option value="asian accessories traditional jade">Asian accessories traditional</option>
                    <option value="ornate jewelry rings necklace">Ornate jewelry rings necklace</option>
                    <option value="sword katana weapon sheathed">Sword katana weapon</option>
                    <option value="staff magical glowing crystal">Staff magical glowing</option>
                    <option value="chains decorative silver">Chains decorative silver</option>
                    <option value="cape flowing dramatic billowing">Cape flowing dramatic</option>
                    <option value="crown royal headpiece golden">Crown royal headpiece</option>
                    <option value="mask mysterious half-face">Mask mysterious</option>
                    <option value="gloves elegant leather">Gloves elegant leather</option>
                  </select>
                  <small class="text-muted">Hold Ctrl/Cmd for multiple</small>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- POSE TAB -->
      <div class="tab-pane fade" id="poseTab" role="tabpanel">
        <div class="section-title"><i class="fas fa-face-grin"></i> Facial Expression</div>
        <div class="card">
          <div class="card-header" data-bs-toggle="collapse" data-bs-target="#expressCard">
            <h5>Expression (40+ Options)</h5>
          </div>
          <div class="collapse show" id="expressCard">
            <div class="card-body">
              <select id="expression" class="form-select" onchange="updatePreview()">
                <option value="">-- None --</option>
                <optgroup label="Confident & Attractive">
                  <option value="handsome attractive charming smile">Handsome attractive charming smile</option>
                  <option value="smoldering seductive gaze">Smoldering seductive gaze</option>
                  <option value="confident smirk arrogant">Confident smirk arrogant</option>
                  <option value="charismatic magnetic presence">Charismatic magnetic presence</option>
                  <option value="alluring captivating stare">Alluring captivating stare</option>
                  <option value="flirtatious playful wink">Flirtatious playful wink</option>
                </optgroup>
                <optgroup label="Intense & Dramatic">
                  <option value="intense focused piercing gaze">Intense focused piercing gaze</option>
                  <option value="fierce determined battle ready">Fierce determined battle ready</option>
                  <option value="cold calculating emotionless">Cold calculating emotionless</option>
                  <option value="menacing threatening dangerous">Menacing threatening dangerous</option>
                  <option value="angry wrathful furious">Angry wrathful furious</option>
                  <option value="pained suffering anguished">Pained suffering anguished</option>
                </optgroup>
                <optgroup label="Mysterious & Brooding">
                  <option value="mysterious brooding enigmatic">Mysterious brooding enigmatic</option>
                  <option value="melancholic sad sorrowful">Melancholic sad sorrowful</option>
                  <option value="distant lost in thought">Distant lost in thought</option>
                  <option value="troubled conflicted inner turmoil">Troubled conflicted</option>
                  <option value="haunted by dark past">Haunted by dark past</option>
                </optgroup>
                <optgroup label="Soft & Vulnerable">
                  <option value="gentle soft kind smile">Gentle soft kind smile</option>
                  <option value="vulnerable exposed emotional">Vulnerable exposed emotional</option>
                  <option value="shy blushing embarrassed">Shy blushing embarrassed</option>
                  <option value="innocent pure angelic">Innocent pure angelic</option>
                  <option value="peaceful serene calm">Peaceful serene calm</option>
                  <option value="sleepy tired drowsy">Sleepy tired drowsy</option>
                </optgroup>
                <optgroup label="Dynamic & Energetic">
                  <option value="excited energetic enthusiastic">Excited energetic enthusiastic</option>
                  <option value="surprised shocked wide-eyed">Surprised shocked wide-eyed</option>
                  <option value="laughing joyful happy">Laughing joyful happy</option>
                  <option value="mischievous playful teasing">Mischievous playful teasing</option>
                  <option value="triumphant victorious proud">Triumphant victorious proud</option>
                </optgroup>
                <optgroup label="Serious & Regal">
                  <option value="regal dignified noble bearing">Regal dignified noble bearing</option>
                  <option value="serious stern authoritative">Serious stern authoritative</option>
                  <option value="wise contemplative thoughtful">Wise contemplative thoughtful</option>
                  <option value="stoic unyielding strong">Stoic unyielding strong</option>
                </optgroup>
              </select>
            </div>
          </div>
        </div>

        <div class="section-title"><i class="fas fa-person-hiking"></i> Body Pose</div>
        <div class="card">
          <div class="card-header" data-bs-toggle="collapse" data-bs-target="#poseBodyCard">
            <h5>Dynamic Poses (50+ Options)</h5>
          </div>
          <div class="collapse show" id="poseBodyCard">
            <div class="card-body">
              <select id="bodyPose" class="form-select" onchange="updatePreview()">
                <option value="">-- None --</option>
                <optgroup label="Standing - Basic">
                  <option value="standing straight facing viewer">Standing straight facing viewer</option>
                  <option value="standing relaxed casual pose">Standing relaxed casual pose</option>
                  <option value="standing arms crossed confident">Standing arms crossed confident</option>
                  <option value="standing hands on hips powerful">Standing hands on hips powerful</option>
                  <option value="standing one hand in pocket">Standing one hand in pocket</option>
                  <option value="standing leaning against wall">Standing leaning against wall</option>
                </optgroup>
                <optgroup label="Standing - Dynamic">
                  <option value="dynamic pose action ready">Dynamic pose action ready</option>
                  <option value="heroic powerful stance dramatic">Heroic powerful stance dramatic</option>
                  <option value="elegant pose graceful refined">Elegant pose graceful refined</option>
                  <option value="confident pose shoulders back">Confident pose shoulders back</option>
                  <option value="contrapposto artistic weight shift">Contrapposto artistic weight shift</option>
                </optgroup>
                <optgroup label="Sitting & Reclining">
                  <option value="sitting relaxed casual">Sitting relaxed casual</option>
                  <option value="sitting legs crossed elegant">Sitting legs crossed elegant</option>
                  <option value="sitting leaning back confident">Sitting leaning back confident</option>
                  <option value="sitting on edge contemplative">Sitting on edge contemplative</option>
                  <option value="reclining on side seductive">Reclining on side seductive</option>
                  <option value="lying down relaxed">Lying down relaxed</option>
                  <option value="kneeling upright dignified">Kneeling upright dignified</option>
                </optgroup>
                <optgroup label="Artistic & Sensual">
                  <option value="looking over shoulder back view">Looking over shoulder back view</option>
                  <option value="face in profile side view">Face in profile side view</option>
                  <option value="three quarter view artistic">Three quarter view artistic</option>
                  <option value="hand through hair casual">Hand through hair casual</option>
                  <option value="hand on chest dramatic">Hand on chest dramatic</option>
                  <option value="arms above head stretching">Arms above head stretching</option>
                  <option value="reaching upward yearning">Reaching upward yearning</option>
                  <option value="intimate close-up personal">Intimate close-up personal</option>
                </optgroup>
                <optgroup label="Action & Combat">
                  <option value="fighting stance combat ready">Fighting stance combat ready</option>
                                   <option value="drawing weapon dynamic motion">Drawing weapon dynamic</option>
                  <option value="mid-action movement blur">Mid-action movement blur</option>
                  <option value="jumping mid-air dynamic">Jumping mid-air dynamic</option>
                  <option value="running sprinting forward">Running sprinting forward</option>
                  <option value="casting spell magical gesture">Casting spell magical gesture</option>
                </optgroup>
                <optgroup label="Vulnerable & Emotional">
                  <option value="kneeling head down submission">Kneeling head down submission</option>
                  <option value="collapsed exhausted defeated">Collapsed exhausted defeated</option>
                  <option value="sitting knees to chest vulnerable">Sitting knees to chest vulnerable</option>
                  <option value="reaching out desperately">Reaching out desperately</option>
                  <option value="hands covering face emotional">Hands covering face emotional</option>
                </optgroup>
              </select>
            </div>
          </div>
        </div>

        <div class="section-title"><i class="fas fa-camera"></i> Camera & Viewing Angle</div>
        <div class="card">
          <div class="card-header" data-bs-toggle="collapse" data-bs-target="#cameraCard">
            <h5>Camera Shot & Angle</h5>
          </div>
          <div class="collapse show" id="cameraCard">
            <div class="card-body">
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="cameraShot">Camera Shot Type</label>
                  <select id="cameraShot" class="form-select" onchange="updatePreview()">
                    <option value="">-- None --</option>
                    <option value="full body shot head to toe">Full body shot (head to toe)</option>
                    <option value="cowboy shot mid-thigh up">Cowboy shot (mid-thigh up)</option>
                    <option value="waist up medium shot">Waist up (medium shot)</option>
                    <option value="chest up portrait">Chest up (portrait)</option>
                    <option value="close-up face detailed">Close-up (face detailed)</option>
                    <option value="extreme close-up eyes features">Extreme close-up (eyes/features)</option>
                    <option value="upper body focus">Upper body focus</option>
                  </select>
                </div>
                <div class="col-md-6 mb-3">
                  <label for="cameraAngle">Camera Angle</label>
                  <select id="cameraAngle" class="form-select" onchange="updatePreview()">
                    <option value="">-- None --</option>
                    <option value="straight on eye level">Straight on (eye level)</option>
                    <option value="low angle looking up heroic">Low angle (looking up, heroic)</option>
                    <option value="high angle looking down">High angle (looking down)</option>
                    <option value="dutch angle tilted dynamic">Dutch angle (tilted, dynamic)</option>
                    <option value="from behind back view">From behind (back view)</option>
                    <option value="from side profile view">From side (profile view)</option>
                    <option value="bird's eye view overhead">Bird's eye view (overhead)</option>
                    <option value="worm's eye view ground up">Worm's eye view (ground up)</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- ENVIRONMENT TAB -->
      <div class="tab-pane fade" id="envTab" role="tabpanel">
        <div class="section-title"><i class="fas fa-mountain"></i> Setting & Background</div>
        <div class="card">
          <div class="card-header" data-bs-toggle="collapse" data-bs-target="#bgCard">
            <h5>Background Setting (40+ Options)</h5>
          </div>
          <div class="collapse show" id="bgCard">
            <div class="card-body">
              <select id="background" class="form-select" onchange="updatePreview()">
                <option value="">-- None --</option>
                <optgroup label="Simple Backgrounds">
                  <option value="simple background solid color">Simple background (solid color)</option>
                  <option value="white background clean">White background clean</option>
                  <option value="black background dramatic">Black background dramatic</option>
                  <option value="gradient background artistic">Gradient background artistic</option>
                  <option value="blurred background bokeh">Blurred background (bokeh)</option>
                </optgroup>
                <optgroup label="Indoor Settings">
                  <option value="bedroom intimate soft lighting">Bedroom intimate soft lighting</option>
                  <option value="bathroom shower steam">Bathroom shower steam</option>
                  <option value="throne room regal grand">Throne room regal grand</option>
                  <option value="library study scholarly">Library study scholarly</option>
                  <option value="gothic cathedral dark">Gothic cathedral dark</option>
                  <option value="modern office professional">Modern office professional</option>
                  <option value="nightclub neon lights">Nightclub neon lights</option>
                  <option value="bar dim atmospheric">Bar dim atmospheric</option>
                </optgroup>
                <optgroup label="Outdoor Natural">
                  <option value="forest lush green mystical">Forest lush green mystical</option>
                  <option value="mountain peak dramatic vista">Mountain peak dramatic</option>
                  <option value="beach ocean waves sunset">Beach ocean waves</option>
                  <option value="desert vast barren dunes">Desert vast barren</option>
                  <option value="field of flowers blooming">Field of flowers blooming</option>
                  <option value="waterfall misty scenic">Waterfall misty scenic</option>
                  <option value="cliffside ocean view">Cliffside ocean view</option>
                </optgroup>
                <optgroup label="Urban & Modern">
                  <option value="city street urban night">City street urban night</option>
                  <option value="rooftop cityscape background">Rooftop cityscape background</option>
                  <option value="alleyway dark gritty">Alleyway dark gritty</option>
                  <option value="neon lit cyberpunk city">Neon lit cyberpunk city</option>
                  <option value="abandoned building ruins">Abandoned building ruins</option>
                  <option value="subway station underground">Subway station underground</option>
                </optgroup>
                <optgroup label="Fantasy & Supernatural">
                  <option value="magical realm ethereal">Magical realm ethereal</option>
                  <option value="hell inferno fire">Hell inferno fire</option>
                  <option value="heaven clouds divine">Heaven clouds divine</option>
                  <option value="battlefield war torn">Battlefield war torn</option>
                  <option value="ancient ruins mystical">Ancient ruins mystical</option>
                  <option value="void cosmic space">Void cosmic space</option>
                  <option value="underwater aquatic depths">Underwater aquatic depths</option>
                </optgroup>
              </select>
            </div>
          </div>
        </div>

        <!-- INTEGRATED LIGHTING SECTION -->
        <div class="section-title"><i class="fas fa-lightbulb"></i> Lighting & Atmosphere</div>
        <div class="card">
          <div class="card-header" data-bs-toggle="collapse" data-bs-target="#lightingCard">
            <h5> Advanced Lighting System (100+ Options)</h5>
          </div>
          <div class="collapse show" id="lightingCard">
            <div class="card-body">
              <!-- Primary Lighting -->
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="primaryLighting"><strong>Primary Light Source</strong></label>
                  <select id="primaryLighting" class="form-select" onchange="updatePreview()">
                    <option value="">-- None --</option>
                    <optgroup label=" Natural Lighting">
                      <option value="sunlight direct">Direct Sunlight</option>
                      <option value="golden hour warm sunset">Golden Hour (Warm)</option>
                      <option value="blue hour twilight">Blue Hour (Twilight)</option>
                      <option value="overcast diffused soft">Overcast Daylight</option>
                      <option value="dappled sunlight through trees">Dappled Sunlight</option>
                      <option value="harsh midday sun">Harsh Midday Sun</option>
                      <option value="soft morning light">Soft Morning Light</option>
                    </optgroup>
                    <optgroup label=" Night & Lunar">
                      <option value="soft moonlight gentle">Soft Moonlight</option>
                      <option value="full moon bright illumination">Full Moon Bright</option>
                      <option value="starlight dim ambient">Starlight Only</option>
                      <option value="moonlit silhouette">Moonlit Silhouette</option>
                      <option value="lunar eclipse red glow">Lunar Eclipse Red</option>
                    </optgroup>
                    <optgroup label=" Artificial Modern">
                      <option value="studio lighting professional">Studio Lighting</option>
                      <option value="ring light beauty">Ring Light (Beauty)</option>
                      <option value="led panels cool white">LED Panels Cool</option>
                      <option value="fluorescent harsh clinical">Fluorescent Harsh</option>
                      <option value="warm incandescent cozy">Warm Incandescent</option>
                      <option value="smart rgb lighting colorful">Smart RGB Lighting</option>
                    </optgroup>
                    <optgroup label=" Neon & Cyberpunk">
                      <option value="neon underglow">Neon Underglow</option>
                      <option value="neon signs multicolor">Neon Signs Multi-Color</option>
                      <option value="pink neon romantic">Pink Neon</option>
                      <option value="blue neon cool">Blue Neon</option>
                      <option value="purple neon mystical">Purple Neon</option>
                      <option value="cyberpunk city lights">Cyberpunk City Lights</option>
                      <option value="bioluminescent glow organic">Bioluminescent Glow</option>
                      <option value="holographic projection light">Holographic Light</option>
                    </optgroup>
                    <optgroup label=" Dramatic Cinematic">
                      <option value="dramatic lighting high contrast">Dramatic Lighting</option>
                      <option value="chiaroscuro strong shadows">Chiaroscuro</option>
                      <option value="low key dark moody">Low Key Lighting</option>
                      <option value="high key bright airy">High Key Lighting</option>
                      <option value="rim lighting edge glow">Rim Lighting</option>
                      <option value="silhouette backlit">Silhouette Backlit</option>
                      <option value="split lighting half face">Split Lighting</option>
                    </optgroup>
                    <optgroup label=" Fire & Warm">
                      <option value="candlelight romantic flickering">Candlelight Romantic</option>
                      <option value="firelight warm flickering">Firelight Flickering</option>
                      <option value="bonfire glow orange">Bonfire Glow</option>
                      <option value="torch light medieval">Torch Light</option>
                      <option value="lantern soft warm">Lantern Soft</option>
                    </optgroup>
                    <optgroup label=" Fantasy & Magic">
                      <option value="magical glow ethereal">Magical Glow</option>
                      <option value="ethereal light otherworldly">Ethereal Light</option>
                      <option value="divine light rays god rays">Divine Light Rays</option>
                      <option value="supernatural aura glowing">Supernatural Aura</option>
                      <option value="glowing runes mystical">Glowing Runes</option>
                      <option value="crystal refraction rainbow">Crystal Refraction</option>
                    </optgroup>
                  </select>
                </div>

                <div class="col-md-6 mb-3">
                  <label for="lightingIntensity"><strong>Lighting Intensity</strong></label>
                  <select id="lightingIntensity" class="form-select" onchange="updatePreview()">
                    <option value="">-- Balanced --</option>
                    <option value="soft lighting gentle diffused">Soft Lighting</option>
                    <option value="low light minimal">Low Light</option>
                    <option value="dim lighting moody">Dim Lighting Moody</option>
                    <option value="bright lighting high exposure">Bright Lighting</option>
                    <option value="harsh lighting hard shadows">Harsh Lighting</option>
                    <option value="overexposed glow blown highlights">Overexposed Glow</option>
                    <option value="underexposed deep shadows">Underexposed Shadows</option>
                  </select>
                </div>
              </div>

              <!-- Secondary & Effects -->
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="lightDirection"><strong>Light Direction</strong></label>
                  <select id="lightDirection" class="form-select" onchange="updatePreview()">
                    <option value="">-- None --</option>
                    <option value="front lighting even illumination">Front Lighting</option>
                    <option value="side lighting dramatic shadows">Side Lighting</option>
                    <option value="backlighting rim glow">Backlighting</option>
                    <option value="top lighting overhead">Top Lighting</option>
                    <option value="bottom lighting spooky">Bottom Lighting</option>
                    <option value="three quarter lighting classic">Three-Quarter Lighting</option>
                    <option value="cross lighting multiple angles">Cross Lighting</option>
                  </select>
                </div>

                <div class="col-md-6 mb-3">
                  <label for="colorTemperature"><strong>Color Temperature</strong></label>
                  <select id="colorTemperature" class="form-select" onchange="updatePreview()">
                    <option value="">-- Neutral --</option>
                    <option value="warm white cozy 3000K">Warm White</option>
                    <option value="cool white clinical 6500K">Cool White</option>
                    <option value="golden warm sunset 2500K">Golden Warm</option>
                    <option value="blue cool moonlight 7000K">Blue Cool</option>
                    <option value="orange warm firelight">Orange Warm</option>
                    <option value="mixed temperature contrasting">Mixed Temperature</option>
                    <option value="orange and teal cinematic">Orange & Teal</option>
                    <option value="pink and blue vaporwave">Pink & Blue</option>
                  </select>
                </div>
              </div>

              <!-- Shadow & Atmosphere -->
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="shadowStyle"><strong>Shadow Style</strong></label>
                  <select id="shadowStyle" class="form-select" onchange="updatePreview()">
                    <option value="">-- None --</option>
                    <option value="soft shadows diffused">Soft Shadows</option>
                    <option value="hard shadows sharp edges">Hard Shadows</option>
                    <option value="dramatic shadows high contrast">Dramatic Shadows</option>
                    <option value="minimal shadows bright">Minimal Shadows</option>
                    <option value="deep shadows low key">Deep Shadows</option>
                    <option value="long shadows low angle">Long Shadows</option>
                    <option value="no shadows ambient only">No Shadows</option>
                    <option value="dappled shadows through leaves">Dappled Shadows</option>
                  </select>
                </div>

                <div class="col-md-6 mb-3">
                  <label for="lightingMood"><strong>Lighting Mood</strong></label>
                  <select id="lightingMood" class="form-select" onchange="updatePreview()">
                    <option value="">-- Neutral --</option>
                    <option value="warm cozy inviting">Warm Cozy</option>
                    <option value="romantic intimate sensual">Romantic Intimate</option>
                    <option value="cool mysterious enigmatic">Cool Mysterious</option>
                    <option value="moody atmospheric dramatic">Moody Atmospheric</option>
                    <option value="dark brooding ominous">Dark Brooding</option>
                    <option value="bright airy cheerful">Bright Airy</option>
                    <option value="ethereal dreamy soft">Ethereal Dreamy</option>
                    <option value="dramatic cinematic epic">Dramatic Cinematic</option>
                  </select>
                </div>
              </div>

              <!-- Atmospheric Effects -->
              <div class="row">
                <div class="col-md-12 mb-3">
                  <label for="atmosphericEffects"><strong>Atmospheric Effects</strong></label>
                  <select id="atmosphericEffects" class="form-select" multiple size="8" onchange="updatePreview()">
                    <option value="">-- None --</option>
                    <optgroup label="Volumetric">
                      <option value="volumetric lighting beams">Volumetric Lighting</option>
                      <option value="god rays crepuscular">God Rays</option>
                      <option value="light shafts dramatic">Light Shafts</option>
                      <option value="sunbeams through window">Sunbeams Through Window</option>
                    </optgroup>
                    <optgroup label="Weather & Particles">
                      <option value="fog diffused soft">Fog Diffused</option>
                      <option value="mist ethereal mysterious">Mist Ethereal</option>
                      <option value="steam backlit shower">Steam Backlit</option>
                      <option value="smoke dramatic swirling">Smoke Dramatic</option>
                      <option value="dust particles visible light">Dust Particles</option>
                      <option value="rain illuminated droplets">Rain Illuminated</option>
                      <option value="snow sparkle reflective">Snow Sparkle</option>
                    </optgroup>
                    <optgroup label="Glow & Sparkle">
                      <option value="lens flare sun star">Lens Flare</option>
                      <option value="light bloom soft glow">Light Bloom</option>
                      <option value="bokeh circles defocused">Bokeh Circles</option>
                      <option value="sparkles floating glitter"> Sparkles Floating</option>
                      <option value="glitter shimmer magical"> Glitter Shimmer</option>
                      <option value="fireflies light orbs">Fireflies/Light Orbs</option>
                      <option value="light particles drifting">Light Particles</option>
                    </optgroup>
                    <optgroup label="2025 Special FX">
                      <option value="chromatic aberration color fringe">Chromatic Aberration</option>
                      <option value="light leak vintage film">Light Leak (Film)</option>
                      <option value="prism effect rainbow">Prism Effect</option>
                      <option value="holographic interference digital">Holographic Interference</option>
                      <option value="digital glitch lighting">Digital Glitch Lighting</option>
                    </optgroup>
                  </select>
                  <small class="text-muted">Hold Ctrl/Cmd for multiple</small>
                </div>
              </div>

                            <!-- Time & Weather Context -->
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="timeOfDay"><strong>Time of Day</strong></label>
                  <select id="timeOfDay" class="form-select" onchange="updatePreview()">
                    <option value="">-- Unspecified --</option>
                    <option value="dawn early morning">Dawn (Early Morning)</option>
                    <option value="morning 8-10am">Morning (8-10 AM)</option>
                    <option value="late morning 10-12">Late Morning (10-12)</option>
                    <option value="noon midday bright">Noon/Midday</option>
                    <option value="afternoon 2-5pm">Afternoon (2-5 PM)</option>
                    <option value="late afternoon golden">Late Afternoon (Golden)</option>
                    <option value="dusk sunset">Dusk/Sunset</option>
                    <option value="twilight blue hour">Twilight (Blue Hour)</option>
                    <option value="night dark">Night (Dark)</option>
                    <option value="midnight deep night">Midnight</option>
                    <option value="pre-dawn darkness">Pre-Dawn</option>
                  </select>
                </div>

                <div class="col-md-6 mb-3">
                  <label for="weatherLighting"><strong>Weather Impact</strong></label>
                  <select id="weatherLighting" class="form-select" onchange="updatePreview()">
                    <option value="">-- Clear Sky --</option>
                    <option value="partly cloudy intermittent">Partly Cloudy</option>
                    <option value="overcast gray soft">Overcast Gray</option>
                    <option value="stormy dramatic dark">Stormy Dramatic</option>
                    <option value="foggy diffused visibility">Foggy Diffused</option>
                    <option value="rainy wet reflections">Rainy Wet</option>
                    <option value="snowy bright reflective">Snowy Bright</option>
                    <option value="humid thick air glow">Humid Thick Air</option>
                    <option value="dusty hazy atmosphere">Dusty/Hazy</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="section-title"><i class="fas fa-cloud"></i> Weather & Season</div>
        <div class="card">
          <div class="card-header" data-bs-toggle="collapse" data-bs-target="#weatherCard">
            <h5>Environmental Conditions</h5>
          </div>
          <div class="collapse show" id="weatherCard">
            <div class="card-body">
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="weather">Weather Condition</label>
                  <select id="weather" class="form-select" onchange="updatePreview()">
                    <option value="">-- None --</option>
                    <option value="clear sunny day bright">Clear sunny day</option>
                    <option value="cloudy overcast gray">Cloudy overcast</option>
                    <option value="raining heavy downpour">Raining heavy downpour</option>
                    <option value="light rain drizzle">Light rain drizzle</option>
                    <option value="thunderstorm lightning dramatic">Thunderstorm with lightning</option>
                    <option value="snowing winter white">Snowing winter scene</option>
                    <option value="foggy misty atmosphere">Foggy misty atmosphere</option>
                    <option value="windy breezy movement">Windy breezy conditions</option>
                    <option value="storm brewing ominous">Storm brewing dramatic</option>
                  </select>
                </div>
                <div class="col-md-6 mb-3">
                  <label for="season">Season</label>
                  <select id="season" class="form-select" onchange="updatePreview()">
                    <option value="">-- None --</option>
                    <option value="spring blooming flowers fresh">Spring (blooming flowers)</option>
                    <option value="summer bright sunny warm">Summer (bright sunny)</option>
                    <option value="autumn fall leaves orange">Autumn (fall leaves)</option>
                    <option value="winter snow cold crisp">Winter (snow cold)</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- EFFECTS TAB -->
      <div class="tab-pane fade" id="effectsTab" role="tabpanel">
        <div class="section-title"><i class="fas fa-heart"></i> Doujinshi Style Effects</div>
        <div class="card">
          <div class="card-header" style="background: linear-gradient(135deg, #ff6b9d, #c084fc);">
            <h5 class="text-white"><i class="fas fa-fire"></i> Special Doujin Effects <span class="doujin-badge">Popular</span></h5>
          </div>
          <div class="card-body">
            <div class="row">
              <div class="col-md-12 mb-3">
                <label for="doujinEffects">Visual Effects (Yaoi/BL Optimized)</label>
                <select id="doujinEffects" class="form-select" multiple size="12" onchange="updatePreview()">
                  <option value="">-- None --</option>
                  <optgroup label=" Sparkle & Glow">
                    <option value="sparkles glitter effect magical"> Sparkles Glitter Effect</option>
                    <option value="screen tone effects manga style">Screen Tone Effects (Manga)</option>
                    <option value="flower petals floating romantic">Flower Petals Floating</option>
                    <option value="light particles shimmering ambient">Light Particles Shimmering</option>
                    <option value="star sparkles twinkling">Star Sparkles Twinkling</option>
                    <option value="glowing aura surrounding body">Glowing Aura Surrounding</option>
                    <option value="ethereal glow soft halo">Ethereal Glow Soft</option>
                  </optgroup>
                  <optgroup label=" Liquid & Wet Effects">
                    <option value="water droplets dripping glistening">Water Droplets Dripping</option>
                    <option value="sweat beads glistening skin">Sweat Beads Glistening</option>
                    <option value="steam rising from body hot">Steam Rising From Body</option>
                    <option value="rain soaked drenched wet">Rain Soaked Drenched</option>
                    <option value="oil sheen glossy skin">Oil Sheen Glossy</option>
                    <option value="condensation humid atmosphere">Condensation Humid</option>
                    <option value="wet clothes clinging translucent">Wet Clothes Clinging</option>
                  </optgroup>
                  <optgroup label=" Romantic & Soft">
                    <option value="soft focus dreamy blur">Soft Focus Dreamy</option>
                    <option value="bokeh background blurred lights">Bokeh Background Blurred</option>
                    <option value="vignette soft edges">Vignette Soft Edges</option>
                    <option value="light leak vintage film">Light Leak Vintage</option>
                    <option value="pastel color palette soft">Pastel Color Palette</option>
                    <option value="warm color grading romantic">Warm Color Grading</option>
                  </optgroup>
                  <optgroup label=" Dynamic & Energy">
                    <option value="motion blur dynamic movement">Motion Blur Dynamic</option>
                    <option value="speed lines action manga">Speed Lines Action</option>
                    <option value="energy aura glowing power">Energy Aura Glowing</option>
                    <option value="lightning electricity crackling">Lightning Electricity</option>
                    <option value="wind effects hair flowing">Wind Effects Hair Flowing</option>
                    <option value="debris floating weightless">Debris Floating Weightless</option>
                  </optgroup>
                  <optgroup label=" Artistic Styles">
                    <option value="cel shaded anime style">Cel-Shaded Anime</option>
                    <option value="painterly brush strokes">Painterly Brush Strokes</option>
                    <option value="watercolor wash soft">Watercolor Wash Soft</option>
                    <option value="ink wash traditional">Ink Wash Traditional</option>
                    <option value="digital painting detailed">Digital Painting Detailed</option>
                  </optgroup>
                  <optgroup label=" Special 2025">
                    <option value="holographic shimmer iridescent">Holographic Shimmer</option>
                    <option value="neon glow edges cyberpunk">Neon Glow Edges</option>
                    <option value="glitch effect digital">Glitch Effect Digital</option>
                    <option value="chromatic aberration artistic">Chromatic Aberration</option>
                  </optgroup>
                </select>
                <small class="text-muted">Hold Ctrl/Cmd for multiple effects</small>
              </div>
            </div>
          </div>
        </div>

        <div class="section-title"><i class="fas fa-wand-magic-sparkles"></i> Additional Visual Effects</div>
        <div class="card">
          <div class="card-header" data-bs-toggle="collapse" data-bs-target="#additionalFXCard">
            <h5>Camera & Post-Processing Effects</h5>
          </div>
          <div class="collapse show" id="additionalFXCard">
            <div class="card-body">
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="depthOfField">Depth of Field</label>
                  <select id="depthOfField" class="form-select" onchange="updatePreview()">
                    <option value="">-- None --</option>
                    <option value="shallow depth of field bokeh">Shallow (Bokeh Background)</option>
                    <option value="deep depth of field sharp">Deep (All Sharp)</option>
                    <option value="selective focus subject">Selective Focus</option>
                    <option value="tilt-shift miniature effect">Tilt-Shift (Miniature)</option>
                  </select>
                </div>
                <div class="col-md-6 mb-3">
                  <label for="filmGrain">Film Grain & Texture</label>
                  <select id="filmGrain" class="form-select" onchange="updatePreview()">
                    <option value="">-- None --</option>
                    <option value="subtle film grain texture">Subtle Film Grain</option>
                    <option value="heavy film grain vintage">Heavy Film Grain</option>
                    <option value="digital noise low light">Digital Noise</option>
                    <option value="paper texture overlay">Paper Texture Overlay</option>
                  </select>
                </div>
              </div>
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="colorGrading">Color Grading</label>
                  <select id="colorGrading" class="form-select" onchange="updatePreview()">
                    <option value="">-- None --</option>
                    <option value="warm color grading orange">Warm Orange Tones</option>
                    <option value="cool color grading blue">Cool Blue Tones</option>
                    <option value="teal and orange cinematic">Teal & Orange Cinematic</option>
                    <option value="desaturated muted colors">Desaturated Muted</option>
                    <option value="vibrant saturated colors">Vibrant Saturated</option>
                    <option value="monochrome black and white">Monochrome B&W</option>
                  </select>
                </div>
                <div class="col-md-6 mb-3">
                  <label for="vignette">Vignette Effect</label>
                  <select id="vignette" class="form-select" onchange="updatePreview()">
                    <option value="">-- None --</option>
                    <option value="subtle vignette soft">Subtle Vignette</option>
                    <option value="heavy vignette dramatic">Heavy Vignette</option>
                    <option value="light vignette edges">Light Vignette Edges</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- QUALITY TAB -->
      <div class="tab-pane fade" id="qualityTab" role="tabpanel">
        <div class="section-title"><i class="fas fa-star"></i> Quality Tags</div>
        <div class="card">
          <div class="card-header" data-bs-toggle="collapse" data-bs-target="#qualityCard">
            <h5>Image Quality & Style Tags (Click to Toggle)</h5>
          </div>
          <div class="collapse show" id="qualityCard">
            <div class="card-body">
              <p class="text-muted small mb-3">Click badges to add/remove quality tags from your prompt</p>
              <div class="quality-tags" id="qualityTagsContainer">
                <!-- Quality Badges -->
                <span class="quality-badge active" data-tag="masterpiece">masterpiece</span>
                <span class="quality-badge active" data-tag="best quality">best quality</span>
                <span class="quality-badge active" data-tag="very aesthetic">very aesthetic</span>
                <span class="quality-badge active" data-tag="absurdres">absurdres</span>
                <span class="quality-badge active" data-tag="detailed">detailed</span>
                <span class="quality-badge" data-tag="smooth quality">smooth quality</span>
                <span class="quality-badge" data-tag="detailed shading">detailed shading</span>
                <span class="quality-badge" data-tag="detailed lighting">detailed lighting</span>
                <span class="quality-badge" data-tag="semi-realistic">semi-realistic</span>
                <span class="quality-badge" data-tag="realistic">realistic</span>
                <span class="quality-badge" data-tag="photorealistic">photorealistic</span>
                <span class="quality-badge" data-tag="hyperrealistic">hyperrealistic</span>
                <span class="quality-badge" data-tag="perfect anatomy">perfect anatomy</span>
                <span class="quality-badge" data-tag="perfect proportions">perfect proportions</span>
                <span class="quality-badge" data-tag="attractive features">attractive features</span>
                <span class="quality-badge" data-tag="beautiful face">beautiful face</span>
                <span class="quality-badge" data-tag="thin delicate lines">thin delicate lines</span>
                <span class="quality-badge" data-tag="sharp focus">sharp focus</span>
                <span class="quality-badge" data-tag="high resolution">high resolution</span>
                <span class="quality-badge" data-tag="8k">8k</span>
                <span class="quality-badge" data-tag="4k">4k</span>
                <span class="quality-badge" data-tag="ultra detailed">ultra detailed</span>
                <span class="quality-badge" data-tag="crisp">crisp</span>
                <span class="quality-badge" data-tag="clear">clear</span>
                <span class="quality-badge" data-tag="professional">professional</span>
                <span class="quality-badge" data-tag="illustration">illustration</span>
                <span class="quality-badge" data-tag="digital art">digital art</span>
                <span class="quality-badge" data-tag="concept art">concept art</span>
                <span class="quality-badge" data-tag="anime style">anime style</span>
                <span class="quality-badge" data-tag="manga style">manga style</span>
              </div>
            </div>
          </div>
        </div>

        <div class="section-title"><i class="fas fa-sliders"></i> Additional Settings</div>
        <div class="card">
          <div class="card-header" data-bs-toggle="collapse" data-bs-target="#settingsCard">
            <h5>Custom Tags & Advanced Options</h5>
          </div>
          <div class="collapse show" id="settingsCard">
            <div class="card-body">
              <div class="mb-3">
                <label for="customTags">Custom Tags (comma-separated)</label>
                <textarea id="customTags" class="form-control" rows="3" placeholder="Enter custom tags separated by commas, e.g., detailed eyes, muscular definition, fantasy armor"></textarea>
                <small class="text-muted">Add any additional custom tags not covered by the presets</small>
              </div>

              <div class="mb-3">
                <label for="negativeTags">Negative Tags (What to Avoid)</label>
                <textarea id="negativeTags" class="form-control" rows="3" placeholder="e.g., low quality, blurry, distorted, bad anatomy">low quality, worst quality, blurry, out of focus, ugly, bad anatomy, bad proportions, deformed, disfigured, mutation, extra limbs</textarea>
                <small class="text-muted">These will be added to the negative prompt</small>
              </div>

              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="artistStyle">Artist Style Reference</label>
                  <select id="artistStyle" class="form-select">
                    <option value="">-- None --</option>
                    <option value="by greg rutkowski">Greg Rutkowski</option>
                    <option value="by sakimichan">Sakimichan</option>
                    <option value="by wlop">WLOP</option>
                    <option value="by artgerm">Artgerm</option>
                    <option value="by ilya kuvshinov">Ilya Kuvshinov</option>
                    <option value="by krenz cushart">Krenz Cushart</option>
                    <option value="pixiv style">Pixiv Style</option>
                    <option value="artstation trending">ArtStation Trending</option>
                  </select>
                </div>
                <div class="col-md-6 mb-3">
                  <label for="renderEngine">Render Engine Style</label>
                  <select id="renderEngine" class="form-select">
                    <option value="">-- None --</option>
                    <option value="unreal engine 5">Unreal Engine 5</option>
                    <option value="octane render">Octane Render</option>
                    <option value="unity engine">Unity Engine</option>
                    <option value="blender cycles">Blender Cycles</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- GENERATE BUTTON -->
    <div class="btn-group-custom mt-4">
      <button class="btn btn-primary btn-lg" onclick="generatePrompt()">
        <i class="fas fa-magic"></i> Generate Full Prompt
      </button>
      <button class="btn btn-success btn-lg" onclick="copyPrompt()">
        <i class="fas fa-copy"></i> Copy to Clipboard
      </button>
      <button class="btn btn-accent btn-lg" onclick="resetAll()">
        <i class="fas fa-redo"></i> Reset All
      </button>
      <button class="btn btn-doujin btn-lg" onclick="randomize()">
        <i class="fas fa-dice"></i> Randomize Character
      </button>
    </div>

    <!-- LOADING ANIMATION -->
    <div class="loading" id="loading">
      <div class="spinner"></div>
      <p>Generating your prompt...</p>
    </div>

    <!-- OUTPUT SECTION -->
    <div class="output-container">
      <div class="card">
        <div class="card-header bg-success text-white">
          <h5><i class="fas fa-code"></i> Generated Prompt Output</h5>
        </div>
        <div class="card-body">
                    <pre id="output">Click "Generate Full Prompt" to create your AI image prompt...</pre>
        </div>
      </div>

      <!-- STATS -->
      <div class="stats" id="stats" style="display:none;">
        <strong>Prompt Stats:</strong> 
        <span id="tokenCount">0</span> tokens | 
        <span id="wordCount">0</span> words | 
        <span id="charCount">0</span> characters
      </div>

      <!-- NEGATIVE PROMPT OUTPUT -->
      <div class="card mt-3" id="negativePromptCard" style="display:none;">
        <div class="card-header bg-danger text-white">
          <h5><i class="fas fa-ban"></i> Negative Prompt (Copy Separately)</h5>
        </div>
        <div class="card-body">
          <pre id="negativeOutput"></pre>
        </div>
      </div>
    </div>
  </div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  'use strict';

  // ============================================
  // STATE MANAGEMENT
  // ============================================
  const AppState = {
    currentPrompt: '',
    currentNegative: '',
    unsavedChanges: false,
    generationCount: 0,
    lastGenerated: null,
    
    // Cache DOM elements
    elements: {},
    
    // History stack
    history: [],
    historyIndex: -1,
    maxHistory: 20,

    init() {
      this.cacheElements();
      this.loadFromLocalStorage();
      this.attachEventListeners();
      this.initializeQualityBadges();
    },

    cacheElements() {
      // Cache frequently accessed elements
      this.elements = {
        previewCard: document.getElementById('previewCard'),
        output: document.getElementById('output'),
        negativeOutput: document.getElementById('negativeOutput'),
        negativePromptCard: document.getElementById('negativePromptCard'),
        stats: document.getElementById('stats'),
        loading: document.getElementById('loading'),
        copyNotification: document.getElementById('copyNotification'),
        wordCount: document.getElementById('wordCount'),
        charCount: document.getElementById('charCount'),
        tokenCount: document.getElementById('tokenCount'),
        
        // Preview elements
        prevArch: document.getElementById('prevArch'),
        prevHair: document.getElementById('prevHair'),
        prevEyes: document.getElementById('prevEyes'),
        prevSkin: document.getElementById('prevSkin'),
        prevBody: document.getElementById('prevBody'),
        prevPose: document.getElementById('prevPose'),
        prevLight: document.getElementById('prevLight'),
        prevSpecial: document.getElementById('prevSpecial'),
      };
    },

    attachEventListeners() {
      // Form change listeners with debouncing
      const selects = document.querySelectorAll('select, textarea, input');
      selects.forEach(element => {
        element.addEventListener('change', this.debounce(() => {
          this.unsavedChanges = true;
          this.updatePreview();
        }, 150));
      });

      // Keyboard shortcuts
      document.addEventListener('keydown', (e) => {
        // Ctrl/Cmd + G: Generate
        if ((e.ctrlKey || e.metaKey) && e.key === 'g') {
          e.preventDefault();
          generatePrompt();
        }
        // Ctrl/Cmd + C: Copy (when output visible)
        if ((e.ctrlKey || e.metaKey) && e.key === 'c' && this.currentPrompt) {
          e.preventDefault();
          copyPrompt();
        }
        // Ctrl/Cmd + R: Reset
        if ((e.ctrlKey || e.metaKey) && e.key === 'r') {
          e.preventDefault();
          resetAll();
        }
        // Ctrl/Cmd + Z: Undo
        if ((e.ctrlKey || e.metaKey) && e.key === 'z' && !e.shiftKey) {
          e.preventDefault();
          this.undo();
        }
        // Ctrl/Cmd + Shift + Z: Redo
        if ((e.ctrlKey || e.metaKey) && e.key === 'z' && e.shiftKey) {
          e.preventDefault();
          this.redo();
        }
      });

      // Before unload warning
      window.addEventListener('beforeunload', (e) => {
        if (this.unsavedChanges && this.currentPrompt) {
          e.preventDefault();
          e.returnValue = 'You have unsaved changes. Are you sure you want to leave?';
          return e.returnValue;
        }
      });

      // Auto-save every 30 seconds
      setInterval(() => {
        if (this.unsavedChanges) {
          this.saveToLocalStorage();
        }
      }, 30000);
    },

    debounce(func, wait) {
      let timeout;
      return function executedFunction(...args) {
        const later = () => {
          clearTimeout(timeout);
          func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
      };
    },

    initializeQualityBadges() {
      const badges = document.querySelectorAll('.quality-badge');
      badges.forEach(badge => {
        badge.addEventListener('click', function(e) {
          e.preventDefault();
          this.classList.toggle('active');
          AppState.updatePreview();
          AppState.unsavedChanges = true;
        });
      });
    },

    updatePreview() {
      try {
        if (!this.elements.previewCard) return;
        
        this.elements.previewCard.style.display = 'block';

        // Get values safely
        const getValue = (id, defaultVal = 'Not set') => {
          const el = document.getElementById(id);
          return el?.value || defaultVal;
        };

        const arch = getValue('characterArchetype');
        const hairStyle = getValue('hairStyle');
        const hairColor = getValue('hairColor');
        const eyes = getValue('eyeColor');
        const skinTone = getValue('skinTone');
        const skinTexture = getValue('skinTexture');
        const body = getValue('muscleDef');
        const pose = getValue('bodyPose');
        const light = getValue('primaryLighting');
        const special = this.getMultiSelectValues('supernatural').join(', ') || 'None';

        // Update preview with truncation
        const truncate = (str, len) => str.length > len ? str.substring(0, len) + '...' : str;

        this.elements.prevArch.textContent = truncate(arch, 50);
        this.elements.prevHair.textContent = truncate(`${hairStyle} ${hairColor}`, 40);
        this.elements.prevEyes.textContent = truncate(eyes, 30);
        this.elements.prevSkin.textContent = truncate(`${skinTone} ${skinTexture}`, 40);
        this.elements.prevBody.textContent = truncate(body, 40);
        this.elements.prevPose.textContent = truncate(pose, 40);
        this.elements.prevLight.textContent = truncate(light, 40);
        this.elements.prevSpecial.textContent = truncate(special, 50);
      } catch (error) {
        console.error('Preview update error:', error);
        this.showError('Failed to update preview');
      }
    },

    getMultiSelectValues(id) {
      try {
        const select = document.getElementById(id);
        if (!select || !select.multiple) return [];
        
        return Array.from(select.selectedOptions)
          .map(opt => opt.value)
          .filter(val => val);
      } catch (error) {
        console.error(`Error getting multi-select values for ${id}:`, error);
        return [];
      }
    },

    getActiveQualityTags() {
      try {
        const activeBadges = document.querySelectorAll('.quality-badge.active');
        return Array.from(activeBadges).map(badge => badge.dataset.tag);
      } catch (error) {
        console.error('Error getting quality tags:', error);
        return ['masterpiece', 'best quality']; // fallback
      }
    },

    saveState() {
      if (this.historyIndex < this.history.length - 1) {
        this.history = this.history.slice(0, this.historyIndex + 1);
      }

      const state = this.captureState();
      this.history.push(state);

      if (this.history.length > this.maxHistory) {
        this.history.shift();
      } else {
        this.historyIndex++;
      }
    },

    captureState() {
      const state = {};
      document.querySelectorAll('select, textarea, input').forEach(el => {
        if (el.id) {
          if (el.multiple) {
            state[el.id] = Array.from(el.selectedOptions).map(opt => opt.value);
          } else {
            state[el.id] = el.value;
          }
        }
      });

      // Capture quality badges
      state.qualityBadges = this.getActiveQualityTags();

      return state;
    },

    restoreState(state) {
      if (!state) return;

      Object.entries(state).forEach(([id, value]) => {
        const el = document.getElementById(id);
        if (!el) return;

        if (el.multiple && Array.isArray(value)) {
          Array.from(el.options).forEach(opt => {
            opt.selected = value.includes(opt.value);
          });
        } else if (id !== 'qualityBadges') {
          el.value = value;
        }
      });

      // Restore quality badges
      if (state.qualityBadges) {
        document.querySelectorAll('.quality-badge').forEach(badge => {
          badge.classList.toggle('active', state.qualityBadges.includes(badge.dataset.tag));
        });
      }

      this.updatePreview();
    },

    undo() {
      if (this.historyIndex > 0) {
        this.historyIndex--;
        this.restoreState(this.history[this.historyIndex]);
        this.showNotification('Undo successful', 'info');
      }
    },

    redo() {
      if (this.historyIndex < this.history.length - 1) {
        this.historyIndex++;
        this.restoreState(this.history[this.historyIndex]);
        this.showNotification('Redo successful', 'info');
      }
    },

    saveToLocalStorage() {
      try {
        const state = this.captureState();
        localStorage.setItem('characterPromptState', JSON.stringify({
          state,
          timestamp: Date.now(),
          version: '1.0'
        }));
        this.unsavedChanges = false;
        console.log('State saved to localStorage');
      } catch (error) {
        console.error('Failed to save state:', error);
      }
    },

    loadFromLocalStorage() {
      try {
        const saved = localStorage.getItem('characterPromptState');
        if (saved) {
          const { state, timestamp } = JSON.parse(saved);
          
          // Only load if less than 7 days old
          const sevenDays = 7 * 24 * 60 * 60 * 1000;
          if (Date.now() - timestamp < sevenDays) {
            this.restoreState(state);
            this.showNotification('Previous session restored', 'success');
          }
        }
      } catch (error) {
        console.error('Failed to load state:', error);
      }
    },

    showNotification(message, type = 'success') {
      const notification = this.elements.copyNotification;
      if (!notification) return;

      notification.innerHTML = `<i class="fas fa-${type === 'success' ? 'check-circle' : 'info-circle'}"></i> ${message}`;
      notification.style.backgroundColor = type === 'success' ? '#059669' : '#0369a1';
      notification.classList.add('show');

      setTimeout(() => {
        notification.classList.remove('show');
      }, 3000);
    },

    showError(message) {
      alert(`Error: ${message}\n\nPlease try again or refresh the page.`);
    }
  };

  // ============================================
  // PROMPT GENERATION
  // ============================================
  function generatePrompt() {
    try {
      // Save state before generation
      AppState.saveState();
      
      // Show loading
      if (AppState.elements.loading) {
        AppState.elements.loading.classList.add('active');
      }

      setTimeout(() => {
        try {
          const promptParts = [];

          // Quality tags first
          const qualityTags = AppState.getActiveQualityTags();
          if (qualityTags.length > 0) {
            promptParts.push(qualityTags.join(', '));
          }

          // Helper function to add values
          const addValue = (id) => {
            const el = document.getElementById(id);
            if (el?.value) {
              promptParts.push(el.value.trim());
            }
          };

          const addMultiple = (id) => {
            const values = AppState.getMultiSelectValues(id);
            if (values.length > 0) {
              promptParts.push(...values);
            }
          };

          // Character basics
          addValue('characterArchetype');
          addValue('ageGroup');
          addValue('bodyFrame');

          // Appearance
          addValue('faceType');
          addValue('facialHair');
          addValue('hairStyle');
          addValue('hairColor');
          addValue('eyeColor');
          addValue('eyeDetail');
          addValue('skinTone');
          addValue('skinTexture');

          // Special features
          addValue('wings');
          addMultiple('supernatural');
          addMultiple('bodyMarks');

          // Body
          addValue('torsoState');
          addValue('muscleDef');
          addValue('chest');
          addValue('shouldersArms');
          addValue('absDetail');

          // Clothing
          addValue('outfit');
          addMultiple('accessories');

          // Pose
          addValue('expression');
          addValue('bodyPose');
          addValue('cameraShot');
          addValue('cameraAngle');

          // Environment
          addValue('background');

          // Lighting (comprehensive)
          addValue('primaryLighting');
          addValue('lightingIntensity');
          addValue('lightDirection');
          addValue('colorTemperature');
          addValue('shadowStyle');
          addValue('lightingMood');
          addMultiple('atmosphericEffects');
          addValue('timeOfDay');
          addValue('weatherLighting');

          // Weather
          addValue('weather');
          addValue('season');

          // Effects
          addMultiple('doujinEffects');
          addValue('depthOfField');
          addValue('filmGrain');
          addValue('colorGrading');
          addValue('vignette');

          // Custom & advanced
          const customTags = document.getElementById('customTags')?.value.trim();
          if (customTags) {
            promptParts.push(customTags);
          }

          addValue('artistStyle');
          addValue('renderEngine');

          // Clean and join
          AppState.currentPrompt = promptParts
            .filter(p => p && p.length > 0)
            .map(p => p.trim())
            .join(', ');

          // Validate prompt
          if (!AppState.currentPrompt || AppState.currentPrompt.length < 10) {
            throw new Error('Prompt too short. Please select more options.');
          }

          // Generate negative prompt
          const negativeInput = document.getElementById('negativeTags')?.value.trim();
          AppState.currentNegative = negativeInput || 
            'low quality, worst quality, blurry, bad anatomy, bad proportions, deformed, disfigured, mutation, extra limbs, missing limbs, ugly, gross proportions';

          // Display output
          if (AppState.elements.output) {
            AppState.elements.output.textContent = AppState.currentPrompt;
            AppState.elements.output.style.display = 'block';
          }

          if (AppState.elements.negativeOutput) {
            AppState.elements.negativeOutput.textContent = AppState.currentNegative;
          }

          if (AppState.elements.negativePromptCard) {
            AppState.elements.negativePromptCard.style.display = 'block';
          }

          // Calculate stats
          const words = AppState.currentPrompt.split(/[\s,]+/).filter(w => w.length > 0);
          const chars = AppState.currentPrompt.length;
          const tokens = Math.ceil(words.length * 1.33); // More accurate token estimate

          if (AppState.elements.wordCount) AppState.elements.wordCount.textContent = words.length;
          if (AppState.elements.charCount) AppState.elements.charCount.textContent = chars;
          if (AppState.elements.tokenCount) AppState.elements.tokenCount.textContent = tokens;
          
          if (AppState.elements.stats) {
            AppState.elements.stats.style.display = 'block';
          }

          // Update state
          AppState.generationCount++;
          AppState.lastGenerated = new Date();
          AppState.unsavedChanges = false;

          // Save to localStorage
          AppState.saveToLocalStorage();

          // Hide loading
          if (AppState.elements.loading) {
            AppState.elements.loading.classList.remove('active');
          }

          // Scroll to output smoothly
          AppState.elements.output?.scrollIntoView({ 
            behavior: 'smooth', 
            block: 'nearest' 
          });

          // Success notification
          AppState.showNotification(`Prompt generated! (${words.length} words, ~${tokens} tokens)`);

        } catch (innerError) {
          console.error('Generation error:', innerError);
          AppState.elements.loading?.classList.remove('active');
          AppState.showError(innerError.message);
        }
      }, 600);

    } catch (error) {
      console.error('Generate prompt error:', error);
      AppState.showError('Failed to generate prompt: ' + error.message);
    }
  }

  // ============================================
  // COPY TO CLIPBOARD
  // ============================================
  async function copyPrompt() {
    if (!AppState.currentPrompt) {
      AppState.showError('Please generate a prompt first!');
      return;
    }

    try {
      const fullText = `POSITIVE PROMPT:\n${AppState.currentPrompt}\n\nNEGATIVE PROMPT:\n${AppState.currentNegative}`;
      
      // Modern clipboard API
      if (navigator.clipboard && navigator.clipboard.writeText) {
        await navigator.clipboard.writeText(fullText);
        AppState.showNotification('Prompt copied to clipboard!');
      } else {
        // Fallback for older browsers
        const textarea = document.createElement('textarea');
        textarea.value = fullText;
        textarea.style.position = 'fixed';
        textarea.style.opacity = '0';
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);
        AppState.showNotification('Prompt copied to clipboard!');
      }

      // Analytics (optional)
      console.log('Prompt copied:', {
        length: AppState.currentPrompt.length,
        timestamp: new Date().toISOString()
      });

    } catch (error) {
      console.error('Copy error:', error);
      AppState.showError('Failed to copy to clipboard. Please copy manually.');
    }
  }

  // ============================================
  // RESET FUNCTIONALITY
  // ============================================
  function resetAll() {
    if (!confirm('Are you sure you want to reset all selections? This cannot be undone.')) {
      return;
    }

    try {
      // Save current state before reset
      AppState.saveState();

      // Reset all form elements
      document.querySelectorAll('select').forEach(select => {
        select.selectedIndex = 0;
      });

      document.querySelectorAll('textarea').forEach(textarea => {
        if (textarea.id !== 'negativeTags') {
          textarea.value = '';
        }
      });

      document.querySelectorAll('input[type="text"]').forEach(input => {
        input.value = '';
      });

      // Reset quality badges to defaults
      const defaultTags = ['masterpiece', 'best quality', 'very aesthetic', 'absurdres', 'detailed'];
      document.querySelectorAll('.quality-badge').forEach(badge => {
        const isDefault = defaultTags.includes(badge.dataset.tag);
               badge.classList.toggle('active', isDefault);
      });

      // Hide outputs
      if (AppState.elements.output) AppState.elements.output.style.display = 'none';
      if (AppState.elements.stats) AppState.elements.stats.style.display = 'none';
      if (AppState.elements.negativePromptCard) AppState.elements.negativePromptCard.style.display = 'none';
      if (AppState.elements.previewCard) AppState.elements.previewCard.style.display = 'none';

      // Clear state
      AppState.currentPrompt = '';
      AppState.currentNegative = '';
      AppState.unsavedChanges = false;

      // Clear localStorage
      localStorage.removeItem('characterPromptState');

      AppState.showNotification('All selections reset!', 'info');

      // Scroll to top
      window.scrollTo({ top: 0, behavior: 'smooth' });

    } catch (error) {
      console.error('Reset error:', error);
      AppState.showError('Failed to reset: ' + error.message);
    }
  }

  // ============================================
  // RANDOMIZE FUNCTIONALITY
  // ============================================
  function randomize() {
    try {
      // Save state before randomization
      AppState.saveState();

      const selectsToRandomize = [
        'characterArchetype',
        'ageGroup',
        'bodyFrame',
        'faceType',
        'facialHair',
        'hairStyle',
        'hairColor',
        'eyeColor',
        'eyeDetail',
        'skinTone',
        'skinTexture',
        'muscleDef',
        'expression',
        'bodyPose',
        'cameraShot',
        'cameraAngle',
        'background',
        'primaryLighting',
        'lightingMood',
        'outfit'
      ];

      let randomizedCount = 0;
      selectsToRandomize.forEach(id => {
        if (randomizeSelect(id)) {
          randomizedCount++;
        }
      });

      // Randomly select some multi-selects
      randomizeMultiSelect('supernatural', 0.3); // 30% chance per option
      randomizeMultiSelect('bodyMarks', 0.2);
      randomizeMultiSelect('doujinEffects', 0.4);
      randomizeMultiSelect('atmosphericEffects', 0.3);

      // Randomize quality badges (keep some defaults)
      const qualityBadges = document.querySelectorAll('.quality-badge');
      qualityBadges.forEach(badge => {
        const tag = badge.dataset.tag;
        // Keep essential tags active
        const essentialTags = ['masterpiece', 'best quality', 'detailed'];
        if (essentialTags.includes(tag)) {
          badge.classList.add('active');
        } else {
          // 60% chance to activate
          badge.classList.toggle('active', Math.random() > 0.4);
        }
      });

      AppState.updatePreview();
      AppState.unsavedChanges = true;

      AppState.showNotification(`Character randomized! (${randomizedCount} attributes changed)`, 'success');

      // Optional: Scroll to a random tab to show variety
      const tabs = ['#charTab', '#appearanceTab', '#bodyTab', '#poseTab', '#envTab', '#effectsTab'];
      const randomTab = tabs[Math.floor(Math.random() * tabs.length)];
      const tabButton = document.querySelector(`[data-bs-target="${randomTab}"]`);
      if (tabButton) {
        tabButton.click();
      }

    } catch (error) {
      console.error('Randomize error:', error);
      AppState.showError('Failed to randomize: ' + error.message);
    }
  }

  function randomizeSelect(id) {
    try {
      const select = document.getElementById(id);
      if (!select) return false;

      const options = Array.from(select.options).filter(opt => opt.value !== '');
      if (options.length === 0) return false;

      const randomOption = options[Math.floor(Math.random() * options.length)];
      select.value = randomOption.value;
      return true;
    } catch (error) {
      console.error(`Failed to randomize ${id}:`, error);
      return false;
    }
  }

  function randomizeMultiSelect(id, probability = 0.3) {
    try {
      const select = document.getElementById(id);
      if (!select || !select.multiple) return;

      Array.from(select.options).forEach(option => {
        if (option.value) {
          option.selected = Math.random() < probability;
        }
      });
    } catch (error) {
      console.error(`Failed to randomize multi-select ${id}:`, error);
    }
  }

  // ============================================
  // PRESET LOADER (ENHANCED)
  // ============================================
  function loadPreset(presetName) {
    try {
      // Save current state before loading preset
      AppState.saveState();

      const presets = {
        'doujin_bishonen': {
          characterArchetype: '1boy solo male focus',
          ageGroup: 'late teens 18-19',
          bodyFrame: 'tall slender graceful',
          faceType: 'ethereal beautiful androgynous',
          hairStyle: 'long flowing hair windswept',
          hairColor: 'platinum blonde white',
          eyeColor: 'violet amethyst deep',
          eyeDetail: 'big expressive eyes detailed',
          skinTone: 'fair pale porcelain',
          skinTexture: 'smooth flawless perfect skin',
          muscleDef: 'soft natural body',
          expression: 'gentle soft kind smile',
          bodyPose: 'elegant pose graceful refined',
          cameraShot: 'cowboy shot mid-thigh up',
          primaryLighting: 'soft moonlight gentle',
          lightingMood: 'ethereal dreamy soft',
          background: 'simple background solid color',
          doujinEffects: ['sparkles glitter effect magical', 'flower petals floating romantic', 'soft focus dreamy blur']
        },
        'doujin_muscular': {
          characterArchetype: '1boy solo male focus',
          ageGroup: 'young adult 20-25',
          bodyFrame: 'muscular powerful built',
          faceType: 'chiseled angular jawline sharp',
          facialHair: 'light stubble 5 o\'clock shadow',
          hairStyle: 'short cropped neat military',
          hairColor: 'deep brown chocolate',
          eyeColor: 'dark brown deep chocolate',
          skinTone: 'golden bronze sun-kissed',
          skinTexture: 'wet skin dripping water droplets',
          torsoState: 'shirtless bare chest exposed',
          muscleDef: 'ripped shredded physique',
          chest: 'well developed pecs',
          absDetail: 'prominent six pack abs',
          shouldersArms: 'bulging massive arms veiny',
          expression: 'confident smirk arrogant',
          bodyPose: 'standing arms crossed confident',
          cameraShot: 'waist up medium shot',
          cameraAngle: 'low angle looking up heroic',
          primaryLighting: 'dramatic lighting high contrast',
          shadowStyle: 'hard shadows sharp edges',
          lightingMood: 'dramatic cinematic epic',
          background: 'simple background solid color',
          doujinEffects: ['water droplets dripping glistening', 'sweat beads glistening skin'],
          depthOfField: 'shallow depth of field bokeh'
        },
        'supernatural_fox': {
          characterArchetype: '1boy solo male focus supernatural hunter tracking creatures',
          ageGroup: 'young adult 20-25',
          bodyFrame: 'lithe agile nimble',
          faceType: 'sharp defined features striking',
          hairStyle: 'long flowing hair windswept',
          hairColor: 'silver white metallic',
          eyeColor: 'amber gold glowing',
          eyeDetail: 'glowing supernatural mystical',
          skinTone: 'fair pale porcelain',
          skinTexture: 'smooth flawless perfect skin',
          supernatural: ['fox ears kemonomimi', 'many fox tails kitsune nine'],
          bodyMarks: ['glowing marks mystical runes'],
          expression: 'mysterious brooding enigmatic',
          bodyPose: 'dynamic pose action ready',
          cameraShot: 'full body shot head to toe',
          primaryLighting: 'magical glow ethereal',
          lightingMood: 'ethereal dreamy soft',
          background: 'forest lush green mystical',
          doujinEffects: ['glowing aura surrounding body', 'ethereal glow soft halo', 'light particles shimmering ambient'],
          atmosphericEffects: ['god rays crepuscular', 'fog diffused soft']
        },
        'wet_shower': {
          characterArchetype: '1boy solo male focus',
          ageGroup: 'young adult 20-25',
          bodyFrame: 'lean athletic toned',
          faceType: 'soft masculine gentle face',
          hairStyle: 'wet slicked dripping',
          hairColor: 'black hair raven',
          eyeColor: 'dark brown deep chocolate',
          skinTone: 'beige natural warm',
          skinTexture: 'soaking wet drenched',
          torsoState: 'towel wrapped around waist shirtless',
          muscleDef: 'toned defined muscles',
          chest: 'defined pecs visible',
          absDetail: 'visible defined abs',
          expression: 'shy blushing embarrassed',
          bodyPose: 'standing relaxed casual pose',
          cameraShot: 'waist up medium shot',
          background: 'bathroom shower steam',
          primaryLighting: 'soft lighting gentle diffused',
          lightingIntensity: 'soft lighting gentle diffused',
          colorTemperature: 'warm white cozy 3000K',
          atmosphericEffects: ['steam backlit shower'],
          doujinEffects: ['water droplets dripping glistening', 'condensation humid atmosphere', 'soft focus dreamy blur'],
          filmGrain: 'subtle film grain texture'
        },
        'cyberpunk_neon': {
          characterArchetype: '1boy solo male focus cyberpunk hacker tech implants',
          ageGroup: 'young adult 20-25',
          bodyFrame: 'lean athletic toned',
          faceType: 'sharp defined features striking',
          hairStyle: 'undercut shaved sides long top',
          hairColor: 'electric blue neon',
          eyeColor: 'glowing bright luminous',
          eyeDetail: 'glowing supernatural mystical',
          skinTone: 'fair pale porcelain',
          skinTexture: 'smooth flawless perfect skin',
          bodyMarks: ['cybernetic implants tech'],
          outfit: 'cyberpunk neon streetwear techwear',
          accessories: ['gloves elegant leather'],
          expression: 'intense focused piercing gaze',
          bodyPose: 'standing leaning against wall',
          cameraShot: 'cowboy shot mid-thigh up',
          cameraAngle: 'dutch angle tilted dynamic',
          background: 'neon lit cyberpunk city',
          primaryLighting: 'neon underglow',
          colorTemperature: 'pink and blue vaporwave',
          lightingMood: 'moody atmospheric dramatic',
          timeOfDay: 'night dark',
          doujinEffects: ['neon glow edges cyberpunk', 'holographic shimmer iridescent', 'glitch effect digital'],
          atmosphericEffects: ['fog diffused soft'],
          depthOfField: 'shallow depth of field bokeh',
          colorGrading: 'teal and orange cinematic'
        },
        'vampire_elegant': {
          characterArchetype: '1boy solo male focus ancient vampire immortal elegant',
          ageGroup: 'ageless timeless immortal',
          bodyFrame: 'tall slender graceful',
          faceType: 'refined elegant noble',
          hairStyle: 'long flowing hair windswept',
          hairColor: 'jet black dark',
          eyeColor: 'blood red crimson',
          eyeDetail: 'sharp intense gaze piercing',
          skinTone: 'fair pale porcelain',
          skinTexture: 'porcelain smooth polished',
          supernatural: ['fangs vampire sharp'],
          outfit: 'gothic dark elegant victorian',
          accessories: ['cape flowing dramatic billowing'],
          expression: 'mysterious brooding enigmatic',
          bodyPose: 'elegant pose graceful refined',
          cameraShot: 'full body shot head to toe',
          cameraAngle: 'low angle looking up heroic',
          background: 'gothic cathedral dark',
          primaryLighting: 'soft moonlight gentle',
          lightingMood: 'dark brooding ominous',
          shadowStyle: 'dramatic shadows high contrast',
          timeOfDay: 'midnight deep night',
          doujinEffects: ['ethereal glow soft halo'],
          atmosphericEffects: ['fog diffused soft', 'god rays crepuscular'],
          depthOfField: 'shallow depth of field bokeh',
          colorGrading: 'desaturated muted colors'
        }
      };

      const preset = presets[presetName];
      if (!preset) {
        throw new Error(`Preset "${presetName}" not found`);
      }

      // Reset first
      document.querySelectorAll('select').forEach(select => select.selectedIndex = 0);
      document.querySelectorAll('textarea:not(#negativeTags)').forEach(ta => ta.value = '');

      // Apply preset values
      Object.entries(preset).forEach(([key, value]) => {
        const element = document.getElementById(key);
        if (!element) return;

        try {
          if (element.multiple && Array.isArray(value)) {
            // Handle multi-select
            Array.from(element.options).forEach(option => {
              option.selected = value.includes(option.value);
            });
          } else if (element.tagName === 'SELECT' || element.tagName === 'TEXTAREA' || element.tagName === 'INPUT') {
            element.value = value;
          }
        } catch (err) {
          console.warn(`Failed to set ${key}:`, err);
        }
      });

      AppState.updatePreview();
      AppState.unsavedChanges = true;

      // Scroll to top
      window.scrollTo({ top: 0, behavior: 'smooth' });

      AppState.showNotification(`Preset "${presetName.replace(/_/g, ' ')}" loaded successfully!`, 'success');

    } catch (error) {
      console.error('Preset load error:', error);
      AppState.showError(`Failed to load preset: ${error.message}`);
    }
  }

  // ============================================
  // EXPORT/IMPORT FUNCTIONALITY
  // ============================================
  function exportCharacter() {
    try {
      const state = AppState.captureState();
      const exportData = {
        version: '1.0',
        timestamp: new Date().toISOString(),
        characterData: state,
        prompt: AppState.currentPrompt,
        negativePrompt: AppState.currentNegative
      };

      const dataStr = JSON.stringify(exportData, null, 2);
      const dataBlob = new Blob([dataStr], { type: 'application/json' });
      const url = URL.createObjectURL(dataBlob);

      const link = document.createElement('a');
      link.href = url;
      link.download = `character-${Date.now()}.json`;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(url);

      AppState.showNotification('Character exported successfully!');
    } catch (error) {
      console.error('Export error:', error);
      AppState.showError('Failed to export character');
    }
  }

  function importCharacter() {
    try {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = '.json';

      input.onchange = async (e) => {
        try {
          const file = e.target.files[0];
          if (!file) return;

          const text = await file.text();
          const data = JSON.parse(text);

          if (!data.characterData) {
                       throw new Error('Invalid character file format');
          }

          // Save current state before import
          AppState.saveState();

          // Restore imported state
          AppState.restoreState(data.characterData);
          
          // Restore prompt if available
          if (data.prompt) {
            AppState.currentPrompt = data.prompt;
            if (AppState.elements.output) {
              AppState.elements.output.textContent = data.prompt;
              AppState.elements.output.style.display = 'block';
            }
          }

          if (data.negativePrompt) {
            AppState.currentNegative = data.negativePrompt;
            if (AppState.elements.negativeOutput) {
              AppState.elements.negativeOutput.textContent = data.negativePrompt;
            }
          }

          AppState.unsavedChanges = true;
          AppState.showNotification('Character imported successfully!');

        } catch (err) {
          console.error('Import error:', err);
          AppState.showError('Failed to import character: ' + err.message);
        }
      };

      input.click();
    } catch (error) {
      console.error('Import setup error:', error);
      AppState.showError('Failed to setup import');
    }
  }

  // ============================================
  // SHARE FUNCTIONALITY
  // ============================================
  async function shareCharacter() {
    if (!AppState.currentPrompt) {
      AppState.showError('Please generate a prompt first!');
      return;
    }

    try {
      const shareData = {
        title: 'Character Prompt',
        text: `Check out this character prompt!\n\n${AppState.currentPrompt.substring(0, 200)}...`,
        url: window.location.href
      };

      if (navigator.share) {
        await navigator.share(shareData);
        AppState.showNotification('Shared successfully!');
      } else {
        // Fallback: copy link
        await navigator.clipboard.writeText(window.location.href);
        AppState.showNotification('Link copied to clipboard!');
      }
    } catch (error) {
      if (error.name !== 'AbortError') {
        console.error('Share error:', error);
      }
    }
  }

  // ============================================
  // ANALYTICS & STATISTICS
  // ============================================
  function getUsageStats() {
    return {
      generationCount: AppState.generationCount,
      lastGenerated: AppState.lastGenerated,
      sessionStart: AppState.sessionStart || new Date(),
      historyLength: AppState.history.length,
      currentPromptLength: AppState.currentPrompt.length
    };
  }

  function showStatistics() {
    const stats = getUsageStats();
    const message = `
 Session Statistics:

 Prompts Generated: ${stats.generationCount}
 Last Generated: ${stats.lastGenerated ? stats.lastGenerated.toLocaleString() : 'Never'}
 Session Duration: ${Math.round((new Date() - stats.sessionStart) / 60000)} minutes
 History Items: ${stats.historyLength}
 Current Prompt: ${stats.currentPromptLength} characters
    `.trim();

    alert(message);
  }

  // ============================================
  // KEYBOARD SHORTCUTS HELP
  // ============================================
  function showKeyboardShortcuts() {
    const shortcuts = `
 Keyboard Shortcuts:

Ctrl/Cmd + G    Generate Prompt
Ctrl/Cmd + C    Copy Prompt
Ctrl/Cmd + R    Reset All
Ctrl/Cmd + Z    Undo
Ctrl/Cmd + Shift + Z    Redo
Ctrl/Cmd + S    Save State
Ctrl/Cmd + E    Export Character
Ctrl/Cmd + I    Import Character
Ctrl/Cmd + /    Show This Help
    `.trim();

    alert(shortcuts);
  }

  // ============================================
  // ADDITIONAL KEYBOARD SHORTCUTS
  // ============================================
  document.addEventListener('keydown', (e) => {
    // Ctrl/Cmd + S: Save
    if ((e.ctrlKey || e.metaKey) && e.key === 's') {
      e.preventDefault();
      AppState.saveToLocalStorage();
      AppState.showNotification('State saved!', 'success');
    }

    // Ctrl/Cmd + E: Export
    if ((e.ctrlKey || e.metaKey) && e.key === 'e') {
      e.preventDefault();
      exportCharacter();
    }

    // Ctrl/Cmd + I: Import
    if ((e.ctrlKey || e.metaKey) && e.key === 'i') {
      e.preventDefault();
      importCharacter();
    }

    // Ctrl/Cmd + /: Help
    if ((e.ctrlKey || e.metaKey) && e.key === '/') {
      e.preventDefault();
      showKeyboardShortcuts();
    }

    // Ctrl/Cmd + K: Statistics
    if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
      e.preventDefault();
      showStatistics();
    }
  });

  // ============================================
  // PROMPT VALIDATION
  // ============================================
  function validatePrompt(prompt) {
    const issues = [];

    if (!prompt || prompt.trim().length === 0) {
      issues.push('Prompt is empty');
    }

    if (prompt.length < 20) {
      issues.push('Prompt is too short (minimum 20 characters)');
    }

    if (prompt.length > 5000) {
      issues.push('Prompt is too long (maximum 5000 characters)');
    }

    // Check for basic character description
    const hasCharacter = /\b(1boy|male|man|character)\b/i.test(prompt);
    if (!hasCharacter) {
      issues.push('Missing character descriptor (1boy, male, etc.)');
    }

    // Check for quality tags
    const hasQuality = /(masterpiece|best quality|detailed|high quality)/i.test(prompt);
    if (!hasQuality) {
      issues.push('Consider adding quality tags');
    }

    return {
      valid: issues.length === 0,
      issues: issues,
      score: Math.max(0, 100 - (issues.length * 20))
    };
  }

  // ============================================
  // PROMPT ENHANCEMENT SUGGESTIONS
  // ============================================
  function suggestEnhancements() {
    if (!AppState.currentPrompt) {
      AppState.showError('Please generate a prompt first!');
      return;
    }

    const suggestions = [];
    const prompt = AppState.currentPrompt.toLowerCase();

    // Check for missing elements
    if (!prompt.includes('lighting')) {
      suggestions.push(' Add lighting information for better atmosphere');
    }

    if (!prompt.includes('background')) {
      suggestions.push(' Consider adding a background setting');
    }

    if (!prompt.includes('pose') && !prompt.includes('standing') && !prompt.includes('sitting')) {
      suggestions.push(' Add a pose or stance for the character');
    }

    if (!prompt.includes('expression')) {
      suggestions.push(' Add facial expression for more emotion');
    }

    if (!prompt.includes('detailed') && !prompt.includes('quality')) {
      suggestions.push(' Add quality enhancement tags');
    }

    if (prompt.split(',').length < 10) {
      suggestions.push(' Prompt is quite short - consider adding more details');
    }

    const validation = validatePrompt(AppState.currentPrompt);
    
    let message = `
 Prompt Enhancement Suggestions

Quality Score: ${validation.score}/100

${suggestions.length > 0 ? suggestions.join('\n\n') : ' Your prompt looks great!'}

${validation.issues.length > 0 ? '\n Issues:\n' + validation.issues.join('\n') : ''}
    `.trim();

    alert(message);
  }

  // ============================================
  // TOKEN CALCULATOR (ADVANCED)
  // ============================================
  function calculateTokens(text) {
    // More accurate token estimation
    // Average: 1 token  0.75 words for English
    const words = text.split(/[\s,]+/).filter(w => w.length > 0);
    const commas = (text.match(/,/g) || []).length;
    const specialChars = (text.match(/[()[\]{}]/g) || []).length;

    const baseTokens = Math.ceil(words.length * 1.33);
    const punctuationTokens = Math.ceil(commas * 0.5);
    const specialTokens = specialChars;

    return {
      total: baseTokens + punctuationTokens + specialTokens,
      words: words.length,
      characters: text.length,
      commas: commas,
      estimate: 'Based on GPT-style tokenization'
    };
  }

  // ============================================
  // PROMPT OPTIMIZER
  // ============================================
  function optimizePrompt() {
    if (!AppState.currentPrompt) {
      AppState.showError('Please generate a prompt first!');
      return;
    }

    try {
      let optimized = AppState.currentPrompt;

      // Remove duplicate tags
      const tags = optimized.split(',').map(t => t.trim());
      const uniqueTags = [...new Set(tags)];
      
      // Remove empty tags
      const cleanedTags = uniqueTags.filter(t => t.length > 0);

      // Sort: quality tags first, then character, then details
      const qualityTags = cleanedTags.filter(t => 
        /masterpiece|quality|detailed|absurdres|aesthetic/.test(t)
      );
      const characterTags = cleanedTags.filter(t => 
        /1boy|male|character|solo/.test(t)
      );
      const otherTags = cleanedTags.filter(t => 
        !qualityTags.includes(t) && !characterTags.includes(t)
      );

      optimized = [...qualityTags, ...characterTags, ...otherTags].join(', ');

      // Update
      AppState.currentPrompt = optimized;
      AppState.elements.output.textContent = optimized;

      // Recalculate stats
      const tokens = calculateTokens(optimized);
      if (AppState.elements.wordCount) AppState.elements.wordCount.textContent = tokens.words;
      if (AppState.elements.charCount) AppState.elements.charCount.textContent = tokens.characters;
      if (AppState.elements.tokenCount) AppState.elements.tokenCount.textContent = tokens.total;

      AppState.showNotification('Prompt optimized! Removed duplicates and reorganized.', 'success');

    } catch (error) {
      console.error('Optimization error:', error);
      AppState.showError('Failed to optimize prompt');
    }
  }

  // ============================================
  // COMPARE WITH PREVIOUS
  // ============================================
  function compareWithPrevious() {
    if (AppState.history.length < 2) {
      AppState.showError('Not enough history to compare');
      return;
    }

    const current = AppState.captureState();
    const previous = AppState.history[AppState.historyIndex - 1];

    const changes = [];
    Object.keys(current).forEach(key => {
      if (current[key] !== previous[key]) {
        changes.push({
          field: key,
          from: previous[key],
          to: current[key]
        });
      }
    });

    if (changes.length === 0) {
      alert('No changes detected from previous state');
      return;
    }

    const message = `
 Changes from Previous Version:

${changes.slice(0, 10).map(c => ` ${c.field}: "${c.from}"  "${c.to}"`).join('\n')}
${changes.length > 10 ? `\n... and ${changes.length - 10} more changes` : ''}
    `.trim();

    alert(message);
  }

  // ============================================
  // AUTO-COMPLETE SUGGESTIONS
  // ============================================
  function setupAutoComplete() {
    const customTagsInput = document.getElementById('customTags');
    if (!customTagsInput) return;

    const commonTags = [
      'detailed eyes', 'detailed hair', 'detailed clothing',
      'fantasy armor', 'magical effects', 'glowing weapons',
      'dramatic pose', 'dynamic angle', 'cinematic lighting',
      'depth of field', 'bokeh background', 'lens flare',
      'particle effects', 'motion blur', 'speed lines'
    ];

    // Create datalist for suggestions
    const datalist = document.createElement('datalist');
    datalist.id = 'tagSuggestions';
    commonTags.forEach(tag => {
      const option = document.createElement('option');
      option.value = tag;
      datalist.appendChild(option);
    });
    document.body.appendChild(datalist);

    customTagsInput.setAttribute('list', 'tagSuggestions');
  }

  // ============================================
  // THEME TOGGLE (BONUS)
  // ============================================
  function toggleTheme() {
    const isDark = document.body.classList.toggle('dark-theme');
    localStorage.setItem('theme', isDark ? 'dark' : 'light');
    AppState.showNotification(`${isDark ? 'Dark' : 'Light'} theme activated`, 'info');
  }

  function loadTheme() {
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme === 'dark') {
      document.body.classList.add('dark-theme');
    }
  }

  // ============================================
  // PERFORMANCE MONITORING
  // ============================================
  const PerformanceMonitor = {
    metrics: {
      generateTime: [],
      updatePreviewTime: [],
      copyTime: []
    },

    measure(name, fn) {
      const start = performance.now();
      const result = fn();
      const end = performance.now();
      const duration = end - start;

      if (this.metrics[name]) {
        this.metrics[name].push(duration);
        // Keep only last 10 measurements
        if (this.metrics[name].length > 10) {
          this.metrics[name].shift();
        }
      }

      if (duration > 100) {
        console.warn(`${name} took ${duration.toFixed(2)}ms (slow)`);
      }

      return result;
    },

    async measureAsync(name, fn) {
      const start = performance.now();
      const result = await fn();
      const end = performance.now();
      const duration = end - start;

      if (this.metrics[name]) {
        this.metrics[name].push(duration);
        if (this.metrics[name].length > 10) {
          this.metrics[name].shift();
        }
      }

      return result;
    },

    getAverages() {
      const averages = {};
      Object.entries(this.metrics).forEach(([name, times]) => {
        if (times.length > 0) {
          averages[name] = (times.reduce((a, b) => a + b, 0) / times.length).toFixed(2);
        }
      });
      return averages;
    },

    report() {
      console.log('Performance Report:', this.getAverages());
    }
  };

  // ============================================
  // INITIALIZATION
  // ============================================
  document.addEventListener('DOMContentLoaded', function() {
    console.log(' Advanced Male Character Prompt Generator Pro - Initializing...');

    try {
      // Initialize app state
      AppState.sessionStart = new Date();
      AppState.init();

      // Setup additional features
      setupAutoComplete();
      loadTheme();

      // Log initialization
      console.log(' Application initialized successfully');
      console.log(' Keyboard shortcuts available - Press Ctrl/Cmd + / for help');

      // Performance monitoring in development
      if (window.location.hostname === 'localhost') {
        setInterval(() => {
          PerformanceMonitor.report();
        }, 60000); // Every minute
      }

    } catch (error) {
      console.error(' Initialization error:', error);
      alert('Failed to initialize application. Please refresh the page.');
    }
  });

  // ============================================
  // ERROR BOUNDARY
  // ============================================
  window.addEventListener('error', (event) => {
    console.error('Global error:', event.error);
    AppState.showError('An unexpected error occurred. Please try refreshing the page.');
  });

  window.addEventListener('unhandledrejection', (event) => {
    console.error('Unhandled promise rejection:', event.reason);
  });

  // ============================================
  // EXPOSE PUBLIC API
  // ============================================
  window.CharacterGenerator = {
    generate: generatePrompt,
    copy: copyPrompt,
    reset: resetAll,
    randomize: randomize,
    export: exportCharacter,
    import: importCharacter,
    loadPreset: loadPreset,
    optimize: optimizePrompt,
    validate: () => validatePrompt(AppState.currentPrompt),
    suggest: suggestEnhancements,
    stats: getUsageStats,
    share: shareCharacter,
    toggleTheme: toggleTheme
  };

  console.log(' Public API available: window.CharacterGenerator');
</script>

</body>
</html>